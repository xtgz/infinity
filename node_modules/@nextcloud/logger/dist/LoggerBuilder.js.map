{"version":3,"file":"LoggerBuilder.js","names":["_auth","require","_contracts","_typeof","o","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","protoProps","staticProps","_defineProperty","obj","value","arg","_toPrimitive","String","input","hint","prim","toPrimitive","undefined","res","call","Number","LoggerBuilder","factory","context","setApp","appId","app","setLogLevel","level","setUid","uid","detectUser","user","getCurrentUser","detectLogLevel","self","onLoaded","document","readyState","_window$_oc_config$lo","_window$_oc_config","window","_oc_config","loglevel","LogLevel","Warn","_oc_debug","Debug","removeEventListener","addEventListener","build","exports"],"sources":["../lib/LoggerBuilder.ts"],"sourcesContent":["import { getCurrentUser } from '@nextcloud/auth'\nimport { IContext, ILogger, ILoggerFactory, LogLevel } from './contracts'\n\ndeclare global {\n    interface Window {\n        _oc_config: {\n            loglevel: LogLevel,\n        },\n        _oc_debug: boolean,\n    }\n}\n\n/**\n * @notExported\n */\nexport class LoggerBuilder {\n\n\tprotected context: IContext\n\n\tprotected factory: ILoggerFactory\n\n\tconstructor(factory: ILoggerFactory) {\n\t\tthis.context = {}\n\t\tthis.factory = factory\n\t}\n\n\t/**\n\t * Set the app name within the logging context\n\t *\n\t * @param appId App name\n\t */\n\tsetApp(appId: string): LoggerBuilder {\n\t\tthis.context.app = appId\n\t\treturn this\n\t}\n\n\t/**\n\t * Set the logging level within the logging context\n\t *\n\t * @param level Logging level\n\t */\n\tsetLogLevel(level: LogLevel) {\n\t\tthis.context.level = level\n\t\treturn this\n\t}\n\n\t/* eslint-disable jsdoc/no-undefined-types */\n\t/**\n\t * Set the user id within the logging context\n\t * @param uid User ID\n\t * @see {@link detectUser}\n\t */\n\t/* eslint-enable jsdoc/no-undefined-types */\n\tsetUid(uid: string): LoggerBuilder {\n\t\tthis.context.uid = uid\n\t\treturn this\n\t}\n\n\t/**\n\t * Detect the currently logged in user and set the user id within the logging context\n\t */\n\tdetectUser(): LoggerBuilder {\n\t\tconst user = getCurrentUser()\n\t\tif (user !== null) {\n\t\t\tthis.context.uid = user.uid\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Detect and use logging level configured in nextcloud config\n\t */\n\tdetectLogLevel(): LoggerBuilder {\n\t\t// eslint-disable-next-line @typescript-eslint/no-this-alias\n\t\tconst self = this\n\n\t\t// Use arrow function to prevent undefined `this` within event handler\n\t\tconst onLoaded = () => {\n\t\t\tif (document.readyState === 'complete' || (document.readyState === 'interactive')) {\n\t\t\t\t// Up to, including, nextcloud 24 the loglevel was not exposed\n\t\t\t\tself.context.level = window._oc_config?.loglevel ?? LogLevel.Warn\n\t\t\t\t// Override loglevel if we are in debug mode\n\t\t\t\tif (window._oc_debug) {\n\t\t\t\t\tself.context.level = LogLevel.Debug\n\t\t\t\t}\n\t\t\t\tdocument.removeEventListener('readystatechange', onLoaded)\n\t\t\t} else {\n\t\t\t\tdocument.addEventListener('readystatechange', onLoaded)\n\t\t\t}\n\t\t}\n\n\t\tonLoaded()\n\t\treturn this\n\t}\n\n\t/** Build a logger using the logging context and factory */\n\tbuild(): ILogger {\n\t\tif (this.context.level === undefined) {\n\t\t\t// No logging level set manually, use the configured one\n\t\t\tthis.detectLogLevel()\n\t\t}\n\n\t\treturn this.factory(this.context)\n\t}\n\n}\n"],"mappings":"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"}