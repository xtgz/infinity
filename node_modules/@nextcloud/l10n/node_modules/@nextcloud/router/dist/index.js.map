{"version":3,"file":"index.js","names":["linkTo","app","file","generateFilePath","exports","linkToRemoteBase","service","getRootUrl","generateRemoteUrl","window","location","protocol","host","generateOcsUrl","url","params","options","allOptions","Object","assign","ocsVersion","version","_generateUrlPath","escape","_build","text","vars","replace","a","b","r","encodeURIComponent","toString","charAt","generateUrl","_window","noRewrite","OC","config","modRewriteWorking","imagePath","indexOf","type","_window2","isCore","coreApps","link","substring","length","encodeURI","getAppRootUrl","webroot","_oc_webroot","pathname","pos","substr","lastIndexOf","_window$_oc_appswebro","_webroots$app","webroots","_oc_appswebroots"],"sources":["../lib/index.ts"],"sourcesContent":["/**\n * Get an url with webroot to a file in an app\n *\n * @param {string} app the id of the app the file belongs to\n * @param {string} file the file path relative to the app folder\n * @return {string} URL with webroot to a file\n */\nexport const linkTo = (app: string, file: string) => generateFilePath(app, '', file)\n\n/**\n * Creates a relative url for remote use\n *\n * @param {string} service id\n * @return {string} the url\n */\nconst linkToRemoteBase = (service: string) => getRootUrl() + '/remote.php/' + service\n\n/**\n * @brief Creates an absolute url for remote use\n * @param {string} service id\n * @return {string} the url\n */\nexport const generateRemoteUrl = (service: string) => window.location.protocol + '//' + window.location.host + linkToRemoteBase(service)\n\n/**\n * Get the base path for the given OCS API service\n *\n * @param {string} url OCS API service url\n * @param {object} params parameters to be replaced into the service url\n * @param {UrlOptions} options options for the parameter replacement\n * @param {boolean} options.escape Set to false if parameters should not be URL encoded (default true)\n * @param {Number} options.ocsVersion OCS version to use (defaults to 2)\n * @return {string} Absolute path for the OCS URL\n */\nexport const generateOcsUrl = (url: string, params?: object, options?: UrlOptions) => {\n    const allOptions = Object.assign({\n        ocsVersion: 2\n    }, options || {})\n\n   const version = (allOptions.ocsVersion === 1) ? 1 : 2\n\n    return window.location.protocol + '//' + window.location.host + getRootUrl() + '/ocs/v' + version + '.php' + _generateUrlPath(url, params, options);\n}\n\nexport interface UrlOptions {\n    escape: boolean,\n    noRewrite: boolean,\n    ocsVersion: Number\n}\n\n/**\n * Generate a url path, which can contain parameters\n *\n * Parameters will be URL encoded automatically\n *\n * @param {string} url address (can contain placeholders e.g. /call/{token} would replace {token} with the value of params.token\n * @param {object} params parameters to be replaced into the address\n * @param {UrlOptions} options options for the parameter replacement\n * @return {string} Path part for the given URL\n */\nconst _generateUrlPath = (url: string, params?: object, options?: UrlOptions) => {\n    const allOptions = Object.assign({\n        escape: true\n    }, options || {})\n\n    const _build = function (text: string, vars: object) {\n        vars = vars || {};\n        return text.replace(/{([^{}]*)}/g,\n            function (a: string, b: any) {\n                var r = vars[b];\n                if (allOptions.escape) {\n                    return (typeof r === 'string' || typeof r === 'number') ? encodeURIComponent(r.toString()) : encodeURIComponent(a);\n                } else {\n                    return (typeof r === 'string' || typeof r === 'number') ? r.toString() : a;\n                }\n            }\n        );\n    };\n\n    if (url.charAt(0) !== '/') {\n        url = '/' + url;\n    }\n\n    return _build(url, params || {});\n}\n\n/**\n * Generate the url with webroot for the given relative url, which can contain parameters\n *\n * Parameters will be URL encoded automatically\n *\n * @param {string} url address (can contain placeholders e.g. /call/{token} would replace {token} with the value of params.token\n * @param {object} params parameters to be replaced into the url\n * @param {UrlOptions} options options for the parameter replacement\n * @param {boolean} options.noRewrite True if you want to force index.php being added\n * @param {boolean} options.escape Set to false if parameters should not be URL encoded (default true)\n * @return {string} URL with webroot for the given relative URL\n */\nexport const generateUrl = (url: string, params?: object, options?: UrlOptions) => {\n    const allOptions = Object.assign({\n        noRewrite: false\n    }, options || {})\n\n    if (window?.OC?.config?.modRewriteWorking === true && !allOptions.noRewrite) {\n        return getRootUrl() + _generateUrlPath(url, params, options);\n    }\n\n    return getRootUrl() + '/index.php' + _generateUrlPath(url, params, options);\n}\n\n/**\n * Get the path with webroot to an image file\n * if no extension is given for the image, it will automatically decide\n * between .png and .svg based on what the browser supports\n *\n * @param {string} app the app id to which the image belongs\n * @param {string} file the name of the image file\n * @return {string}\n */\nexport const imagePath = (app: string, file: string) => {\n    if (file.indexOf('.') === -1) {\n        //if no extension is given, use svg\n        return generateFilePath(app, 'img', file + '.svg')\n    }\n\n    return generateFilePath(app, 'img', file)\n}\n\n/**\n * Get the url with webroot for a file in an app\n *\n * @param {string} app the id of the app\n * @param {string} type the type of the file to link to (e.g. css,img,ajax.template)\n * @param {string} file the filename\n * @return {string} URL with webroot for a file in an app\n */\nexport const generateFilePath = (app: string, type: string, file: string) => {\n    const isCore = window?.OC?.coreApps?.indexOf(app) !== -1\n    let link = getRootUrl()\n    if (file.substring(file.length - 3) === 'php' && !isCore) {\n        link += '/index.php/apps/' + app;\n        if (file !== 'index.php') {\n            link += '/'\n            if (type) {\n                link += encodeURI(type + '/')\n            }\n            link += file\n        }\n    } else if (file.substring(file.length - 3) !== 'php' && !isCore) {\n        link = getAppRootUrl(app)\n        if (type) {\n            link += '/' + type + '/'\n        }\n        if (link.substring(link.length - 1) !== '/') {\n            link += '/'\n        }\n        link += file\n    } else {\n        if ((app === 'settings' || app === 'core' || app === 'search') && type === 'ajax') {\n            link += '/index.php/'\n        } else {\n            link += '/'\n        }\n        if (!isCore) {\n            link += 'apps/'\n        }\n        if (app !== '') {\n            app += '/'\n            link += app\n        }\n        if (type) {\n            link += type + '/'\n        }\n        link += file\n    }\n    return link\n}\n\n/**\n * Return the web root path where this Nextcloud instance\n * is accessible, with a leading slash.\n * For example \"/nextcloud\".\n *\n * @return {string} web root path\n */\nexport function getRootUrl(): string {\n    let webroot = window._oc_webroot\n\n    if (typeof webroot === 'undefined') {\n        webroot = location.pathname\n        const pos = webroot.indexOf('/index.php/')\n        if (pos !== -1) {\n            webroot = webroot.substr(0, pos)\n        } else {\n            webroot = webroot.substr(0, webroot.lastIndexOf('/'))\n        }\n    }\n    return webroot\n}\n\n/**\n * Return the web root path for a given app\n * @param {string} app The ID of the app\n */\nexport function getAppRootUrl(app: string): string {\n    const webroots = window._oc_appswebroots ?? {}\n    return webroots[app] ?? ''\n}\n"],"mappings":"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"}