{"version":3,"file":"index.cjs","sources":["../src/parser.js","../src/utility/namespaceUtility.js","../src/utility/xmlUtility.js","../src/errors/attachError.js","../src/errors/networkRequestAbortedError.js","../src/errors/networkRequestError.js","../src/errors/networkRequestHttpError.js","../src/errors/networkRequestServerError.js","../src/errors/networkRequestClientError.js","../src/request.js","../src/utility/stringUtility.js","../src/models/davEventListener.js","../src/debug.js","../src/propset/davCollectionPropSet.js","../src/models/davObject.js","../src/models/davCollection.js","../src/models/davCollectionPublishable.js","../src/models/davCollectionShareable.js","../src/models/vobject.js","../src/propset/calendarPropSet.js","../src/models/calendar.js","../src/models/subscription.js","../src/propset/scheduleInboxPropSet.js","../src/models/scheduleInbox.js","../src/models/scheduleOutbox.js","../src/models/calendarTrashBin.js","../src/models/deletedCalendar.js","../src/models/calendarHome.js","../src/propset/addressBookPropSet.js","../src/models/vcard.js","../src/models/addressBook.js","../src/models/addressBookHome.js","../src/propset/principalPropSet.js","../src/models/principal.js","../src/index.js"],"sourcesContent":["/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n/**\n *\n */\nexport default class Parser {\n\n\t/**\n\t *\n\t */\n\tconstructor() {\n\t\t/**\n\t\t * Key Value Map of propertyName => parser\n\t\t * @type {object}\n\t\t * @private\n\t\t */\n\t\tthis._parser = {}\n\n\t\t// initialize default parsers shipped with this lib\n\t\tthis._registerDefaultParsers()\n\t}\n\n\t/**\n\t * checks if a parser exists for a given property name\n\t *\n\t * @param {string} propertyName\n\t * @return {boolean}\n\t */\n\tcanParse(propertyName) {\n\t\treturn Object.prototype.hasOwnProperty.call(this._parser, propertyName)\n\t}\n\n\t/**\n\t * parses a single prop Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {*}\n\t */\n\tparse(document, node, resolver) {\n\t\tconst propertyName = `{${node.namespaceURI}}${node.localName}`\n\t\tif (!this.canParse(propertyName)) {\n\t\t\tthrow new Error(`Unable to parse unknown property \"${propertyName}\"`)\n\t\t}\n\n\t\treturn this._parser[propertyName](document, node, resolver)\n\t}\n\n\t/**\n\t * registers a parser for propertyName\n\t *\n\t * @param {string} propertyName\n\t * @param {Function} parser\n\t */\n\tregisterParser(propertyName, parser) {\n\t\tthis._parser[propertyName] = parser\n\t}\n\n\t/**\n\t * unregisters a parser for propertyName\n\t *\n\t * @param {string} propertyName\n\t */\n\tunregisterParser(propertyName) {\n\t\tdelete this._parser[propertyName]\n\t}\n\n\t/**\n\t * registers the predefined parsers\n\t *\n\t * @private\n\t */\n\t_registerDefaultParsers() {\n\t\t// RFC 4918 - HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV)\n\t\tthis.registerParser('{DAV:}displayname', Parser.text)\n\t\tthis.registerParser('{DAV:}creationdate', Parser.text)\n\t\tthis.registerParser('{DAV:}getcontentlength', Parser.decInt)\n\t\tthis.registerParser('{DAV:}getcontenttype', Parser.text)\n\t\tthis.registerParser('{DAV:}getcontentlanguage', Parser.text)\n\t\tthis.registerParser('{DAV:}getlastmodified', Parser.rfc1123Date)\n\t\tthis.registerParser('{DAV:}getetag', Parser.text)\n\t\tthis.registerParser('{DAV:}resourcetype', Parser.resourceType)\n\n\t\t// RFC 3744 - Web Distributed Authoring and Versioning (WebDAV) Access Control Protocol\n\t\tthis.registerParser('{DAV:}inherited-acl-set', Parser.hrefs)\n\t\tthis.registerParser('{DAV:}group', Parser.href)\n\t\tthis.registerParser('{DAV:}owner', Parser.href)\n\t\tthis.registerParser('{DAV:}current-user-privilege-set', Parser.privileges)\n\t\tthis.registerParser('{DAV:}principal-collection-set', Parser.hrefs)\n\t\tthis.registerParser('{DAV:}principal-URL', Parser.href)\n\t\tthis.registerParser('{DAV:}alternate-URI-set', Parser.hrefs)\n\t\tthis.registerParser('{DAV:}group-member-set', Parser.hrefs)\n\t\tthis.registerParser('{DAV:}group-membership', Parser.hrefs)\n\n\t\t// RFC 5397 - WebDAV Current Principal Extension\n\t\tthis.registerParser('{DAV:}current-user-principal', Parser.currentUserPrincipal)\n\n\t\t// RFC 6578 - Collection Synchronization for Web Distributed Authoring and Versioning (WebDAV)\n\t\tthis.registerParser('{DAV:}sync-token', Parser.text)\n\n\t\t// RFC 6352 - CardDAV: vCard Extensions to Web Distributed Authoring and Versioning (WebDAV)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:carddav}address-data', Parser.text)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:carddav}addressbook-description', Parser.text)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:carddav}supported-address-data', Parser.addressDataTypes)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:carddav}max-resource-size', Parser.decInt)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:carddav}addressbook-home-set', Parser.hrefs)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:carddav}principal-address', Parser.href)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:carddav}supported-collation-set', Parser.supportedCardDAVCollations)\n\n\t\t// RFC 4791 - Calendaring Extensions to WebDAV (CalDAV)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}calendar-data', Parser.text)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}calendar-home-set', Parser.hrefs)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}calendar-description', Parser.text)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}calendar-timezone', Parser.text)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}supported-calendar-component-set', Parser.calendarComps)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}supported-calendar-data', Parser.calendarDatas)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}max-resource-size', Parser.decInt)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}min-date-time', Parser.iCalendarTimestamp)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}max-date-time', Parser.iCalendarTimestamp)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}max-instances', Parser.decInt)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}max-attendees-per-instance', Parser.decInt)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}supported-collation-set', Parser.supportedCalDAVCollations)\n\n\t\t// RFC 6638 - Scheduling Extensions to CalDAV\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}schedule-outbox-URL', Parser.href)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}schedule-inbox-URL', Parser.href)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}calendar-user-address-set', Parser.hrefs)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}calendar-user-type', Parser.text)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}schedule-calendar-transp', Parser.scheduleCalendarTransp)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}schedule-default-calendar-URL', Parser.href)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}schedule-tag', Parser.text)\n\n\t\t// RFC 7809 - Calendaring Extensions to WebDAV (CalDAV): Time Zones by Reference\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}timezone-service-set', Parser.hrefs)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}calendar-timezone-id', Parser.text)\n\n\t\t// RFC 7953 - Calendar Availability\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}calendar-availability', Parser.text)\n\n\t\t// Apple\n\t\tthis.registerParser('{http://apple.com/ns/ical/}calendar-order', Parser.decInt)\n\t\tthis.registerParser('{http://apple.com/ns/ical/}calendar-color', Parser.color)\n\t\tthis.registerParser('{http://calendarserver.org/ns/}source', Parser.href)\n\n\t\t// https://tools.ietf.org/html/draft-daboo-valarm-extensions-04#section-11.1\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}default-alarm-vevent-datetime', Parser.text)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}default-alarm-vevent-date', Parser.text)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}default-alarm-vtodo-datetime', Parser.text)\n\t\tthis.registerParser('{urn:ietf:params:xml:ns:caldav}default-alarm-vtodo-date', Parser.text)\n\n\t\t// https://github.com/apple/ccs-calendarserver/blob/master/doc/Extensions/caldav-ctag.txt\n\t\tthis.registerParser('{http://calendarserver.org/ns/}getctag', Parser.text)\n\n\t\t// https://github.com/apple/ccs-calendarserver/blob/master/doc/Extensions/caldav-proxy.txt\n\t\tthis.registerParser('{http://calendarserver.org/ns/}calendar-proxy-read-for', Parser.hrefs)\n\t\tthis.registerParser('{http://calendarserver.org/ns/}calendar-proxy-write-for', Parser.hrefs)\n\n\t\t// https://github.com/apple/ccs-calendarserver/blob/master/doc/Extensions/caldav-sharing.txt\n\t\tthis.registerParser('{http://calendarserver.org/ns/}allowed-sharing-modes', Parser.allowedSharingModes)\n\t\tthis.registerParser('{http://calendarserver.org/ns/}shared-url', Parser.href)\n\t\tthis.registerParser('{http://sabredav.org/ns}owner-principal', Parser.href)\n\t\tthis.registerParser('{http://sabredav.org/ns}read-only', Parser.bool)\n\t\tthis.registerParser('{http://calendarserver.org/ns/}pre-publish-url', Parser.href)\n\t\tthis.registerParser('{http://calendarserver.org/ns/}publish-url', Parser.href)\n\n\t\t// Nextcloud custom sharing\n\t\tthis.registerParser('{http://owncloud.org/ns}invite', Parser.ocInvite)\n\n\t\t// Nextcloud specific\n\t\tthis.registerParser('{http://owncloud.org/ns}calendar-enabled', Parser.bool)\n\t\tthis.registerParser('{http://owncloud.org/ns}enabled', Parser.bool)\n\t\tthis.registerParser('{http://owncloud.org/ns}read-only', Parser.bool)\n\t\tthis.registerParser('{http://nextcloud.com/ns}owner-displayname', Parser.text)\n\t\tthis.registerParser('{http://nextcloud.com/ns}deleted-at', Parser.iso8601DateTime)\n\t\tthis.registerParser('{http://nextcloud.com/ns}calendar-uri', Parser.text)\n\t\tthis.registerParser('{http://nextcloud.com/ns}has-photo', Parser.bool)\n\t\tthis.registerParser('{http://nextcloud.com/ns}trash-bin-retention-duration', Parser.decInt)\n\t\tthis.registerParser('{http://nextcloud.com/ns}language', Parser.text)\n\t\tthis.registerParser('{http://nextcloud.com/ns}room-type', Parser.text)\n\t\tthis.registerParser('{http://nextcloud.com/ns}room-seating-capacity', Parser.decInt)\n\t\tthis.registerParser('{http://nextcloud.com/ns}room-building-address', Parser.text)\n\t\tthis.registerParser('{http://nextcloud.com/ns}room-building-story', Parser.text)\n\t\tthis.registerParser('{http://nextcloud.com/ns}room-building-room-number', Parser.text)\n\t\tthis.registerParser('{http://nextcloud.com/ns}room-features', Parser.text)\n\n\t\t// Sabre/Dav specific\n\t\tthis.registerParser('{http://sabredav.org/ns}email-address', Parser.text)\n\t}\n\n\t/**\n\t * returns text value of Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {string}\n\t */\n\tstatic text(document, node, resolver) {\n\t\treturn document.evaluate('string(.)', node, resolver, XPathResult.ANY_TYPE, null).stringValue\n\t}\n\n\t/**\n\t * returns boolean value of Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {boolean}\n\t */\n\tstatic bool(document, node, resolver) {\n\t\treturn Parser.text(document, node, resolver) === '1'\n\t}\n\n\t/**\n\t * returns decimal integer value of Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {number}\n\t */\n\tstatic decInt(document, node, resolver) {\n\t\treturn parseInt(Parser.text(document, node, resolver), 10)\n\t}\n\n\t/**\n\t * returns Date value of Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {Date}\n\t */\n\tstatic rfc1123Date(document, node, resolver) {\n\t\tconst text = Parser.text(document, node, resolver)\n\n\t\t// TODO this might not work in every browser\n\t\treturn new Date(text)\n\t}\n\n\t/**\n\t * returns Date from an ISO8601 string\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {Date}\n\t */\n\tstatic iso8601DateTime(document, node, resolver) {\n\t\tconst text = Parser.text(document, node, resolver)\n\n\t\treturn new Date(text)\n\t}\n\n\t/**\n\t * returns Date value of Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {Date}\n\t */\n\tstatic iCalendarTimestamp(document, node, resolver) {\n\t\tconst text = Parser.text(document, node, resolver)\n\n\t\tconst year = parseInt(text.slice(0, 4), 10)\n\t\tconst month = parseInt(text.slice(4, 6), 10) - 1\n\t\tconst date = parseInt(text.slice(6, 8), 10)\n\n\t\tconst hour = parseInt(text.slice(9, 11), 10)\n\t\tconst minute = parseInt(text.slice(11, 13), 10)\n\t\tconst second = parseInt(text.slice(13, 15), 10)\n\n\t\tconst dateObj = new Date()\n\t\tdateObj.setUTCFullYear(year, month, date)\n\t\tdateObj.setUTCHours(hour, minute, second, 0)\n\t\treturn dateObj\n\t}\n\n\t/**\n\t * parses a {DAV:}resourcetype Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {string[]}\n\t */\n\tstatic resourceType(document, node, resolver) {\n\t\tconst result = []\n\t\tconst children = document.evaluate('*', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet childNode\n\n\t\twhile ((childNode = children.iterateNext()) !== null) {\n\t\t\tconst ns = document.evaluate('namespace-uri(.)', childNode, resolver, XPathResult.ANY_TYPE, null).stringValue\n\t\t\tconst local = document.evaluate('local-name(.)', childNode, resolver, XPathResult.ANY_TYPE, null).stringValue\n\n\t\t\tresult.push(`{${ns}}${local}`)\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * parses a node with one href nodes as child\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {string}\n\t */\n\tstatic href(document, node, resolver) {\n\t\treturn document.evaluate('string(d:href)', node, resolver, XPathResult.ANY_TYPE, null).stringValue\n\t}\n\n\t/**\n\t * parses a node with multiple href nodes as children\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {string[]}\n\t */\n\tstatic hrefs(document, node, resolver) {\n\t\tconst result = []\n\t\tconst hrefs = document.evaluate('d:href', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet hrefNode\n\n\t\twhile ((hrefNode = hrefs.iterateNext()) !== null) {\n\t\t\tresult.push(document.evaluate('string(.)', hrefNode, resolver, XPathResult.ANY_TYPE, null).stringValue)\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * Parses a set of {DAV:}privilege Nodes\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {string[]}\n\t */\n\tstatic privileges(document, node, resolver) {\n\t\tconst result = []\n\t\tconst privileges = document.evaluate('d:privilege/*', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet privilegeNode\n\n\t\twhile ((privilegeNode = privileges.iterateNext()) !== null) {\n\t\t\tconst ns = document.evaluate('namespace-uri(.)', privilegeNode, resolver, XPathResult.ANY_TYPE, null).stringValue\n\t\t\tconst local = document.evaluate('local-name(.)', privilegeNode, resolver, XPathResult.ANY_TYPE, null).stringValue\n\n\t\t\tresult.push(`{${ns}}${local}`)\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * parses the {DAV:}current-user-principal Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {object}\n\t * @property {string} type\n\t * @property {string} href\n\t */\n\tstatic currentUserPrincipal(document, node, resolver) {\n\t\tconst unauthenticatedCount\n\t\t\t= document.evaluate('count(d:unauthenticated)', node, resolver, XPathResult.ANY_TYPE, null).numberValue\n\n\t\tif (unauthenticatedCount !== 0) {\n\t\t\treturn {\n\t\t\t\ttype: 'unauthenticated',\n\t\t\t\thref: null,\n\t\t\t}\n\t\t} else {\n\t\t\treturn {\n\t\t\t\ttype: 'href',\n\t\t\t\thref: Parser.href(...arguments),\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Parses a {urn:ietf:params:xml:ns:carddav}supported-address-data Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {*}\n\t */\n\tstatic addressDataTypes(document, node, resolver) {\n\t\tconst result = []\n\t\tconst addressDatas = document.evaluate('cr:address-data-type', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet addressDataNode\n\n\t\twhile ((addressDataNode = addressDatas.iterateNext()) !== null) {\n\t\t\tresult.push({\n\t\t\t\t'content-type': document.evaluate('string(@content-type)', addressDataNode, resolver, XPathResult.ANY_TYPE, null).stringValue,\n\t\t\t\tversion: document.evaluate('string(@version)', addressDataNode, resolver, XPathResult.ANY_TYPE, null).stringValue,\n\t\t\t})\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * Parses a {urn:ietf:params:xml:ns:carddav}supported-collation-set Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {*}\n\t */\n\tstatic supportedCardDAVCollations(document, node, resolver) {\n\t\tconst result = []\n\t\tconst collations = document.evaluate('cr:supported-collation', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet collationNode\n\n\t\twhile ((collationNode = collations.iterateNext()) !== null) {\n\t\t\tresult.push(document.evaluate('string(.)', collationNode, resolver, XPathResult.ANY_TYPE, null).stringValue)\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * Parses a {urn:ietf:params:xml:ns:caldav}supported-collation-set Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {*}\n\t */\n\tstatic supportedCalDAVCollations(document, node, resolver) {\n\t\tconst result = []\n\t\tconst collations = document.evaluate('cl:supported-collation', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet collationNode\n\n\t\twhile ((collationNode = collations.iterateNext()) !== null) {\n\t\t\tresult.push(document.evaluate('string(.)', collationNode, resolver, XPathResult.ANY_TYPE, null).stringValue)\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * Parses a {urn:ietf:params:xml:ns:caldav}supported-calendar-component-set Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {string[]}\n\t */\n\tstatic calendarComps(document, node, resolver) {\n\t\tconst result = []\n\t\tconst comps = document.evaluate('cl:comp', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet compNode\n\n\t\twhile ((compNode = comps.iterateNext()) !== null) {\n\t\t\tresult.push(document.evaluate('string(@name)', compNode, resolver, XPathResult.ANY_TYPE, null).stringValue)\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * Parses a {urn:ietf:params:xml:ns:caldav}supported-calendar-data Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {*}\n\t */\n\tstatic calendarDatas(document, node, resolver) {\n\t\tconst result = []\n\t\tconst calendarDatas = document.evaluate('cl:calendar-data', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet calendarDataNode\n\n\t\twhile ((calendarDataNode = calendarDatas.iterateNext()) !== null) {\n\t\t\tresult.push({\n\t\t\t\t'content-type': document.evaluate('string(@content-type)', calendarDataNode, resolver, XPathResult.ANY_TYPE, null).stringValue,\n\t\t\t\tversion: document.evaluate('string(@version)', calendarDataNode, resolver, XPathResult.ANY_TYPE, null).stringValue,\n\t\t\t})\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * Parses a {urn:ietf:params:xml:ns:caldav}schedule-calendar-transp Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {string}\n\t */\n\tstatic scheduleCalendarTransp(document, node, resolver) {\n\t\tconst children = document.evaluate('cl:opaque | cl:transparent', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tconst childNode = children.iterateNext()\n\t\tif (childNode) {\n\t\t\treturn document.evaluate('local-name(.)', childNode, resolver, XPathResult.ANY_TYPE, null).stringValue\n\t\t}\n\t}\n\n\t/**\n\t * Parses a {http://apple.com/ns/ical/}calendar-color Node\n\t * strips the alpha value of RGB values\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {string}\n\t */\n\tstatic color(document, node, resolver) {\n\t\tconst text = Parser.text(document, node, resolver)\n\t\t// some stupid clients store an alpha value in the rgb hash (like #rrggbbaa) *cough cough* Apple Calendar *cough cough*\n\t\t// but some browsers can't parse that *cough cough* Safari 9 *cough cough*\n\t\t// Safari 10 seems to support this though\n\t\tif (text.length === 9) {\n\t\t\treturn text.slice(0, 7)\n\t\t}\n\n\t\treturn text\n\t}\n\n\t/**\n\t * Parses a {http://calendarserver.org/ns/}allowed-sharing-modes Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {string[]}\n\t */\n\tstatic allowedSharingModes(document, node, resolver) {\n\t\tconst result = []\n\t\tconst children = document.evaluate('cs:can-be-shared | cs:can-be-published', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet childNode\n\n\t\twhile ((childNode = children.iterateNext()) !== null) {\n\t\t\tconst ns = document.evaluate('namespace-uri(.)', childNode, resolver, XPathResult.ANY_TYPE, null).stringValue\n\t\t\tconst local = document.evaluate('local-name(.)', childNode, resolver, XPathResult.ANY_TYPE, null).stringValue\n\n\t\t\tresult.push(`{${ns}}${local}`)\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * Parses a {http://owncloud.org/ns}invite Node\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {*}\n\t */\n\tstatic ocInvite(document, node, resolver) {\n\t\tconst result = []\n\t\tconst users = document.evaluate('oc:user', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet userNode\n\n\t\twhile ((userNode = users.iterateNext()) !== null) {\n\t\t\tresult.push({\n\t\t\t\thref: Parser.href(document, userNode, resolver),\n\t\t\t\t'common-name': document.evaluate('string(oc:common-name)', userNode, resolver, XPathResult.ANY_TYPE, null).stringValue,\n\t\t\t\t'invite-accepted': document.evaluate('count(oc:invite-accepted)', userNode, resolver, XPathResult.ANY_TYPE, null).numberValue === 1,\n\t\t\t\taccess: Parser.ocAccess(document, userNode, resolver),\n\t\t\t})\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * Parses a set of {http://owncloud.org/ns}access Nodes\n\t *\n\t * @param {Document} document\n\t * @param {Node} node\n\t * @param {XPathNSResolver} resolver\n\t * @return {string[]}\n\t */\n\tstatic ocAccess(document, node, resolver) {\n\t\tconst result = []\n\t\tconst privileges = document.evaluate('oc:access/*', node, resolver, XPathResult.ANY_TYPE, null)\n\t\tlet privilegeNode\n\n\t\twhile ((privilegeNode = privileges.iterateNext()) !== null) {\n\t\t\tconst ns = document.evaluate('namespace-uri(.)', privilegeNode, resolver, XPathResult.ANY_TYPE, null).stringValue\n\t\t\tconst local = document.evaluate('local-name(.)', privilegeNode, resolver, XPathResult.ANY_TYPE, null).stringValue\n\n\t\t\tresult.push(`{${ns}}${local}`)\n\t\t}\n\n\t\treturn result\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nexport const DAV = 'DAV:'\nexport const IETF_CALDAV = 'urn:ietf:params:xml:ns:caldav'\nexport const IETF_CARDDAV = 'urn:ietf:params:xml:ns:carddav'\nexport const OWNCLOUD = 'http://owncloud.org/ns'\nexport const NEXTCLOUD = 'http://nextcloud.com/ns'\nexport const APPLE = 'http://apple.com/ns/ical/'\nexport const CALENDARSERVER = 'http://calendarserver.org/ns/'\nexport const SABREDAV = 'http://sabredav.org/ns'\n\nexport const NS_MAP = {\n\td: DAV,\n\tcl: IETF_CALDAV,\n\tcr: IETF_CARDDAV,\n\toc: OWNCLOUD,\n\tnc: NEXTCLOUD,\n\taapl: APPLE,\n\tcs: CALENDARSERVER,\n\tsd: SABREDAV,\n}\n\n/**\n * maps namespace like DAV: to it's short equivalent\n *\n * @param {string} short\n * @return {string}\n */\nexport function resolve(short) {\n\treturn NS_MAP[short] || null\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nconst serializer = new XMLSerializer()\nlet prefixMap = {}\n\n/**\n * builds the root skeleton\n *\n * @params {...Array} array of namespace / name pairs\n * @return {*[]}\n */\nexport function getRootSkeleton() {\n\tif (arguments.length === 0) {\n\t\treturn [{}, null]\n\t}\n\n\tconst skeleton = {\n\t\tname: arguments[0],\n\t\tchildren: [],\n\t}\n\n\tlet childrenWrapper = skeleton.children\n\n\tconst args = Array.prototype.slice.call(arguments, 1)\n\targs.forEach(function(argument) {\n\t\tconst level = {\n\t\t\tname: argument,\n\t\t\tchildren: [],\n\t\t}\n\t\tchildrenWrapper.push(level)\n\t\tchildrenWrapper = level.children\n\t})\n\n\treturn [skeleton, childrenWrapper]\n}\n\n/**\n * serializes an simple xml representation into a string\n *\n * @param {object} json\n * @return {string}\n */\nexport function serialize(json) {\n\tjson = json || {}\n\tif (typeof json !== 'object' || !Object.prototype.hasOwnProperty.call(json, 'name')) {\n\t\treturn ''\n\t}\n\n\tconst root = document.implementation.createDocument('', '', null)\n\txmlify(root, root, json)\n\n\treturn serializer.serializeToString(root)\n}\n\nfunction xmlify(xmlDoc, parent, json) {\n\tconst [ns, localName] = json.name\n\tconst element = xmlDoc.createElementNS(ns, getPrefixedNameForNamespace(ns, localName))\n\n\tjson.attributes = json.attributes || []\n\tjson.attributes.forEach((attribute) => {\n\t\tif (attribute.length === 2) {\n\t\t\tconst [name, value] = attribute\n\t\t\telement.setAttribute(name, value)\n\t\t} else {\n\t\t\tconst [namespace, localName, value] = attribute\n\t\t\telement.setAttributeNS(namespace, localName, value)\n\t\t}\n\t})\n\n\tif (json.value) {\n\t\telement.textContent = json.value\n\t} else if (json.children) {\n\t\tjson.children.forEach((child) => {\n\t\t\txmlify(xmlDoc, element, child)\n\t\t})\n\t}\n\n\tparent.appendChild(element)\n}\n\nexport function resetPrefixMap() {\n\tprefixMap = {}\n}\n\nfunction getPrefixedNameForNamespace(ns, localName) {\n\tif (!Object.prototype.hasOwnProperty.call(prefixMap, ns)) {\n\t\tprefixMap[ns] = 'x' + Object.keys(prefixMap).length\n\t}\n\n\treturn prefixMap[ns] + ':' + localName\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n/**\n * Generic error class that allows attaching more than just a message\n *\n * @abstract\n */\nexport default class AttachError extends Error {\n\n\t/**\n\t *\n\t * @param {object} attach\n\t */\n\tconstructor(attach) {\n\t\tsuper()\n\n\t\tObject.assign(this, attach)\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport AttachError from './attachError.js'\n\nexport default class NetworkRequestAbortedError extends AttachError {}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport AttachError from './attachError.js'\n\nexport default class NetworkRequestError extends AttachError {}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport AttachError from './attachError.js'\n\nexport default class NetworkRequestHttpError extends AttachError {}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport NetworkRequestHttpError from './networkRequestHttpError.js'\n\nexport default class NetworkRequestServerError extends NetworkRequestHttpError {}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport NetworkRequestHttpError from './networkRequestHttpError.js'\n\nexport default class NetworkRequestClientError extends NetworkRequestHttpError {}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as NS from './utility/namespaceUtility.js'\nimport * as XMLUtility from './utility/xmlUtility.js'\n\nimport NetworkRequestAbortedError from './errors/networkRequestAbortedError.js'\nimport NetworkRequestError from './errors/networkRequestError.js'\nimport NetworkRequestServerError from './errors/networkRequestServerError.js'\nimport NetworkRequestClientError from './errors/networkRequestClientError.js'\nimport NetworkRequestHttpError from './errors/networkRequestHttpError.js'\n\n/**\n * Request class is used to send any kind of request to the DAV server\n * It also parses incoming XML responses\n */\nexport default class Request {\n\n\t/**\n\t * Creates a new Request object\n\t *\n\t * @param {string} baseUrl - root url of DAV server, use OC.remote('dav')\n\t * @param {Parser} parser - instance of Parser class\n\t * @param {Function} xhrProvider - Function that returns new XMLHttpRequest objects\n\t */\n\tconstructor(baseUrl, parser, xhrProvider = () => new XMLHttpRequest()) {\n\t\tthis.baseUrl = baseUrl\n\t\tthis.parser = parser\n\t\tthis.xhrProvider = xhrProvider\n\t}\n\n\t/**\n\t * sends a GET request\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync get(url, headers = {}, body = null, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\treturn this.request('GET', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a PATCH request\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync patch(url, headers, body, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\treturn this.request('PATCH', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a POST request\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync post(url, headers, body, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\treturn this.request('POST', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a PUT request\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync put(url, headers, body, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\treturn this.request('PUT', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a DELETE request\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync delete(url, headers = {}, body = null, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\treturn this.request('DELETE', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a COPY request\n\t * https://tools.ietf.org/html/rfc4918#section-9.8\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {string} destination - place to copy the object/collection to\n\t * @param {number | string} depth - 0 = copy collection without content, Infinity = copy collection with content\n\t * @param {boolean} overwrite - whether or not to overwrite destination if existing\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync copy(url, destination, depth = 0, overwrite = false, headers = {}, body = null, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\theaders.Destination = destination\n\t\theaders.Depth = depth\n\t\theaders.Overwrite = overwrite ? 'T' : 'F'\n\n\t\treturn this.request('COPY', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a MOVE request\n\t * https://tools.ietf.org/html/rfc4918#section-9.9\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {string} destination - place to move the object/collection to\n\t * @param {boolean} overwrite - whether or not to overwrite destination if existing\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync move(url, destination, overwrite = false, headers = {}, body = null, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\theaders.Destination = destination\n\t\theaders.Depth = 'Infinity'\n\t\theaders.Overwrite = overwrite ? 'T' : 'F'\n\n\t\treturn this.request('MOVE', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a LOCK request\n\t * https://tools.ietf.org/html/rfc4918#section-9.10\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync lock(url, headers = {}, body = null, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\n\t\t// TODO - add parameters for Depth and Timeout\n\n\t\treturn this.request('LOCK', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends an UNLOCK request\n\t * https://tools.ietf.org/html/rfc4918#section-9.11\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync unlock(url, headers = {}, body = null, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\n\t\t// TODO - add parameter for Lock-Token\n\n\t\treturn this.request('UNLOCK', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a PROPFIND request\n\t * https://tools.ietf.org/html/rfc4918#section-9.1\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {string[][]} properties - list of properties to search for, formatted as [namespace, localName]\n\t * @param {number | string} depth - Depth header to send\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync propFind(url, properties, depth = 0, headers = {}, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\t// adjust headers\n\t\theaders.Depth = depth\n\n\t\t// create request body\n\t\tconst [skeleton, dPropChildren] = XMLUtility.getRootSkeleton([NS.DAV, 'propfind'], [NS.DAV, 'prop'])\n\t\tdPropChildren.push(...properties.map(p => ({ name: p })))\n\t\tconst body = XMLUtility.serialize(skeleton)\n\n\t\treturn this.request('PROPFIND', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a PROPPATCH request\n\t * https://tools.ietf.org/html/rfc4918#section-9.2\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync propPatch(url, headers, body, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\treturn this.request('PROPPATCH', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a MKCOL request\n\t * https://tools.ietf.org/html/rfc4918#section-9.3\n\t * https://tools.ietf.org/html/rfc5689\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync mkCol(url, headers, body, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\treturn this.request('MKCOL', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends a REPORT request\n\t * https://tools.ietf.org/html/rfc3253#section-3.6\n\t *\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync report(url, headers, body, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\treturn this.request('REPORT', url, headers, body, beforeRequestHandler, afterRequestHandler)\n\t}\n\n\t/**\n\t * sends generic request\n\t *\n\t * @param {string} method - HTTP Method name\n\t * @param {string} url - URL to do the request on\n\t * @param {object} headers - additional HTTP headers to send\n\t * @param {string} body - request body\n\t * @param {Function} beforeRequestHandler - custom function to be called before the request is made\n\t * @param {Function} afterRequestHandler - custom function to be called after the request was made\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync request(method, url, headers, body, beforeRequestHandler = () => null, afterRequestHandler = () => null) {\n\t\tconst xhr = this.xhrProvider()\n\t\tconst assignHeaders = Object.assign({}, getDefaultHeaders(), headers)\n\n\t\txhr.open(method, this.absoluteUrl(url), true)\n\n\t\tfor (const header in assignHeaders) {\n\t\t\txhr.setRequestHeader(header, assignHeaders[header])\n\t\t}\n\n\t\tbeforeRequestHandler(xhr)\n\n\t\tif (body === null || body === undefined) {\n\t\t\txhr.send()\n\t\t} else {\n\t\t\txhr.send(body)\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\txhr.onreadystatechange = () => {\n\t\t\t\tif (xhr.readyState !== 4) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tafterRequestHandler(xhr)\n\n\t\t\t\tlet responseBody = xhr.response\n\t\t\t\tif (!wasRequestSuccessful(xhr.status)) {\n\t\t\t\t\tif (xhr.status >= 400 && xhr.status < 500) {\n\t\t\t\t\t\treject(new NetworkRequestClientError({\n\t\t\t\t\t\t\tbody: responseBody,\n\t\t\t\t\t\t\tstatus: xhr.status,\n\t\t\t\t\t\t\txhr,\n\t\t\t\t\t\t}))\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tif (xhr.status >= 500 && xhr.status < 600) {\n\t\t\t\t\t\treject(new NetworkRequestServerError({\n\t\t\t\t\t\t\tbody: responseBody,\n\t\t\t\t\t\t\tstatus: xhr.status,\n\t\t\t\t\t\t\txhr,\n\t\t\t\t\t\t}))\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\treject(new NetworkRequestHttpError({\n\t\t\t\t\t\tbody: responseBody,\n\t\t\t\t\t\tstatus: xhr.status,\n\t\t\t\t\t\txhr,\n\t\t\t\t\t}))\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (xhr.status === 207) {\n\t\t\t\t\tresponseBody = this._parseMultiStatusResponse(responseBody)\n\t\t\t\t\tif (parseInt(assignHeaders.Depth, 10) === 0 && method === 'PROPFIND') {\n\t\t\t\t\t\tresponseBody = responseBody[Object.keys(responseBody)[0]]\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve({\n\t\t\t\t\tbody: responseBody,\n\t\t\t\t\tstatus: xhr.status,\n\t\t\t\t\txhr,\n\t\t\t\t})\n\t\t\t}\n\n\t\t\txhr.onerror = () => reject(new NetworkRequestError({\n\t\t\t\tbody: null,\n\t\t\t\tstatus: -1,\n\t\t\t\txhr,\n\t\t\t}))\n\n\t\t\txhr.onabort = () => reject(new NetworkRequestAbortedError({\n\t\t\t\tbody: null,\n\t\t\t\tstatus: -1,\n\t\t\t\txhr,\n\t\t\t}))\n\t\t})\n\t}\n\n\t/**\n\t * returns name of file / folder of a url\n\t *\n\t * @param url\n\t * @params {string} url\n\t * @return {string}\n\t */\n\tfilename(url) {\n\t\tlet pathname = this.pathname(url)\n\t\tif (pathname.slice(-1) === '/') {\n\t\t\tpathname = pathname.slice(0, -1)\n\t\t}\n\n\t\tconst slashPos = pathname.lastIndexOf('/')\n\t\treturn pathname.slice(slashPos)\n\t}\n\n\t/**\n\t * returns pathname for a URL\n\t *\n\t * @param url\n\t * @params {string} url\n\t * @return {string}\n\t */\n\tpathname(url) {\n\t\tconst urlObject = new URL(url, this.baseUrl)\n\t\treturn urlObject.pathname\n\t}\n\n\t/**\n\t * returns absolute url\n\t *\n\t * @param {string} url\n\t * @return {string}\n\t */\n\tabsoluteUrl(url) {\n\t\tconst urlObject = new URL(url, this.baseUrl)\n\t\treturn urlObject.href\n\t}\n\n\t/**\n\t * parses a multi status response (207), sorts them by path\n\t * and drops all unsuccessful responses\n\t *\n\t * @param {string} body\n\t * @return {object}\n\t * @private\n\t */\n\t_parseMultiStatusResponse(body) {\n\t\tconst result = {}\n\t\tconst domParser = new DOMParser()\n\t\tconst document = domParser.parseFromString(body, 'application/xml')\n\n\t\tconst responses = document.evaluate('/d:multistatus/d:response', document, NS.resolve, XPathResult.ANY_TYPE, null)\n\t\tlet responseNode\n\n\t\twhile ((responseNode = responses.iterateNext()) !== null) {\n\t\t\tconst href = document.evaluate('string(d:href)', responseNode, NS.resolve, XPathResult.ANY_TYPE, null).stringValue\n\t\t\tconst parsedProperties = {}\n\t\t\tconst propStats = document.evaluate('d:propstat', responseNode, NS.resolve, XPathResult.ANY_TYPE, null)\n\t\t\tlet propStatNode\n\n\t\t\twhile ((propStatNode = propStats.iterateNext()) !== null) {\n\t\t\t\tconst status = document.evaluate('string(d:status)', propStatNode, NS.resolve, XPathResult.ANY_TYPE, null).stringValue\n\t\t\t\tif (!wasRequestSuccessful(getStatusCodeFromString(status))) {\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\n\t\t\t\tconst props = document.evaluate('d:prop/*', propStatNode, NS.resolve, XPathResult.ANY_TYPE, null)\n\t\t\t\tlet propNode\n\n\t\t\t\twhile ((propNode = props.iterateNext()) !== null) {\n\t\t\t\t\tif (this.parser.canParse(`{${propNode.namespaceURI}}${propNode.localName}`)) {\n\t\t\t\t\t\tparsedProperties[`{${propNode.namespaceURI}}${propNode.localName}`]\n\t\t\t\t\t\t\t= this.parser.parse(document, propNode, NS.resolve)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult[href] = parsedProperties\n\t\t}\n\n\t\treturn result\n\t}\n\n}\n\n/**\n * Check if response code is in the 2xx section\n *\n * @param {number} status\n * @return {boolean}\n * @private\n */\nfunction wasRequestSuccessful(status) {\n\treturn status >= 200 && status < 300\n}\n\n/**\n * Extract numeric status code from string like \"HTTP/1.1 200 OK\"\n *\n * @param {string} status\n * @return {number}\n * @private\n */\nfunction getStatusCodeFromString(status) {\n\treturn parseInt(status.split(' ')[1], 10)\n}\n\n/**\n * get object with default headers to include in every request\n *\n * @return {object}\n * @property {string} depth\n * @property {string} Content-Type\n * @private\n */\nfunction getDefaultHeaders() {\n\t// TODO: https://tools.ietf.org/html/rfc4918#section-9.1\n\t// \"Servers SHOULD treat request without a Depth header\n\t// as if a \"Depth: infinity\" header was included.\"\n\t// Should infinity be the default?\n\n\treturn {\n\t\tDepth: '0',\n\t\t'Content-Type': 'application/xml; charset=utf-8',\n\t}\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n// uuidv4 taken from https://stackoverflow.com/a/2117523\nfunction uuidv4() {\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n\t\tconst r = Math.random() * 16 | 0; const v = c === 'x' ? r : (r & 0x3 | 0x8)\n\t\treturn v.toString(16).toUpperCase()\n\t})\n}\n\n/**\n * generates a unique id with the option to pass a prefix and a filetype\n *\n * @param {string} prefix\n * @param {string} suffix\n * @return {string}\n */\nexport function uid(prefix, suffix) {\n\tprefix = prefix || ''\n\tsuffix = suffix || ''\n\n\tif (prefix !== '') {\n\t\tprefix += '-'\n\t}\n\tif (suffix !== '') {\n\t\tsuffix = '.' + suffix\n\t}\n\n\treturn prefix + uuidv4() + suffix\n}\n\n/**\n * generates a uri and checks with isAvailable, whether or not the uri is still available\n *\n * @param {string} start\n * @param {Function} isAvailable\n * @return {string}\n */\nexport function uri(start, isAvailable) {\n\tstart = start || ''\n\n\tlet uri = start.toString().toLowerCase()\n\t\t.replace(/\\s+/g, '-') // Replace spaces with -\n\t\t.replace(/[^\\w-]+/g, '') // Remove all non-word chars\n\t\t.replace(/--+/g, '-') // Replace multiple - with single -\n\t\t.replace(/^-+/, '') // Trim - from start of text\n\t\t.replace(/-+$/, '') // Trim - from end of text\n\n\tif (uri === '') {\n\t\turi = '-'\n\t}\n\n\tif (isAvailable(uri)) {\n\t\treturn uri\n\t}\n\n\tif (uri.indexOf('-') === -1) {\n\t\turi = uri + '-1'\n\t\tif (isAvailable(uri)) {\n\t\t\treturn uri\n\t\t}\n\t}\n\n\t// === false because !undefined = true, possible infinite loop\n\tdo {\n\t\tconst positionLastDash = uri.lastIndexOf('-')\n\t\tconst firstPart = uri.slice(0, positionLastDash)\n\t\tlet lastPart = uri.slice(positionLastDash + 1)\n\n\t\tif (lastPart.match(/^\\d+$/)) {\n\t\t\tlastPart = parseInt(lastPart)\n\t\t\tlastPart++\n\n\t\t\turi = firstPart + '-' + lastPart\n\t\t} else {\n\t\t\turi = uri + '-1'\n\t\t}\n\t} while (isAvailable(uri) === false)\n\n\treturn uri\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nexport default class DAVEventListener {\n\n\tconstructor() {\n\t\tthis._eventListeners = {}\n\t}\n\n\t/**\n\t * adds an event listener\n\t *\n\t * @param {string} type\n\t * @param {Function} listener\n\t * @param {object} options\n\t */\n\taddEventListener(type, listener, options = null) {\n\t\tthis._eventListeners[type] = this._eventListeners[type] || []\n\t\tthis._eventListeners[type].push({ listener, options })\n\t}\n\n\t/**\n\t * removes an event listener\n\t *\n\t * @param {string} type\n\t * @param {Function} dListener\n\t */\n\tremoveEventListener(type, dListener) {\n\t\tif (!this._eventListeners[type]) {\n\t\t\treturn\n\t\t}\n\n\t\tconst index = this._eventListeners[type]\n\t\t\t.findIndex(({ listener }) => listener === dListener)\n\t\tif (index === -1) {\n\t\t\treturn\n\t\t}\n\t\tthis._eventListeners[type].splice(index, 1)\n\t}\n\n\t/**\n\t * dispatch event on object\n\t *\n\t * @param {string} type\n\t * @param {DAVEvent} event\n\t */\n\tdispatchEvent(type, event) {\n\t\tif (!this._eventListeners[type]) {\n\t\t\treturn\n\t\t}\n\n\t\tconst listenersToCall = []\n\t\tconst listenersToCallAndRemove = []\n\t\tthis._eventListeners[type].forEach(({ listener, options }) => {\n\t\t\tif (options && options.once) {\n\t\t\t\tlistenersToCallAndRemove.push(listener)\n\t\t\t} else {\n\t\t\t\tlistenersToCall.push(listener)\n\t\t\t}\n\t\t})\n\n\t\tlistenersToCallAndRemove.forEach(listener => {\n\t\t\tthis.removeEventListener(type, listener)\n\t\t\tlistener(event)\n\t\t})\n\t\tlistenersToCall.forEach(listener => {\n\t\t\tlistener(event)\n\t\t})\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n/**\n * creates a debug function bound to a context\n * @param {string} context\n * @return {Function}\n */\nexport function debugFactory(context) {\n\treturn (...args) => {\n\t\tif (debugFactory.enabled) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.debug(context, ...args)\n\t\t}\n\t}\n}\n\ndebugFactory.enabled = false\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as NS from '../utility/namespaceUtility.js'\n\n/**\n *\n * This function is capable of creating the propset xml structure for:\n * - {DAV:}displayname\n *\n * @param {object} props\n * @return {object}\n */\nexport default function davCollectionPropSet(props) {\n\tconst xmlified = []\n\n\tObject.entries(props).forEach(([key, value]) => {\n\t\tswitch (key) {\n\t\tcase '{DAV:}displayname':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.DAV, 'displayname'],\n\t\t\t\tvalue,\n\t\t\t})\n\t\t\tbreak\n\n\t\tdefault:\n\t\t\tbreak\n\t\t}\n\t})\n\n\treturn xmlified\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport DAVEventListener from './davEventListener.js'\nimport NetworkRequestClientError from '../errors/networkRequestClientError.js'\nimport * as NS from '../utility/namespaceUtility.js'\n\nimport { debugFactory } from '../debug.js'\nconst debug = debugFactory('DavObject')\n\n/**\n * @class\n * @classdesc Generic DavObject aka file\n */\nexport class DavObject extends DAVEventListener {\n\n\t/**\n\t * @param {DavCollection} parent - The parent collection this DavObject is a child of\n\t * @param {Request} request - The request object initialized by DavClient\n\t * @param {string} url - Full url of this DavObject\n\t * @param {object} props - Properties including etag, content-type, etc.\n\t * @param {boolean} isPartial - Are we dealing with the complete or just partial addressbook / calendar data\n\t */\n\tconstructor(parent, request, url, props, isPartial = false) {\n\t\tsuper()\n\n\t\tObject.assign(this, {\n\t\t\t// parameters\n\t\t\t_parent: parent,\n\t\t\t_request: request,\n\t\t\t_url: url,\n\t\t\t_props: props,\n\t\t\t// housekeeping\n\t\t\t_isPartial: isPartial,\n\t\t\t_isDirty: false,\n\t\t})\n\n\t\tthis._exposeProperty('etag', NS.DAV, 'getetag', true)\n\t\tthis._exposeProperty('contenttype', NS.DAV, 'getcontenttype')\n\n\t\tObject.defineProperty(this, 'url', {\n\t\t\tget: () => this._url,\n\t\t})\n\t}\n\n\t/**\n\t * gets unfiltered data for this object\n\t *\n\t * @param {boolean} forceReFetch Always refetch data, even if not partial\n\t * @return {Promise<void>}\n\t */\n\tasync fetchCompleteData(forceReFetch = false) {\n\t\tif (!forceReFetch && !this.isPartial()) {\n\t\t\treturn\n\t\t}\n\n\t\tconst request = await this._request.propFind(this._url, this.constructor.getPropFindList(), 0)\n\t\tthis._props = request.body\n\t\tthis._isDirty = false\n\t\tthis._isPartial = false\n\t}\n\n\t/**\n\t * copies a DavObject to a different DavCollection\n\t * @param {DavCollection} collection\n\t * @param {boolean} overwrite\n\t * @param headers\n\t * @return {Promise<DavObject>} Promise that resolves to the copied DavObject\n\t */\n\tasync copy(collection, overwrite = false, headers = {}) {\n\t\tdebug(`copying ${this.url} from ${this._parent.url} to ${collection.url}`)\n\n\t\tif (this._parent === collection) {\n\t\t\tthrow new Error('Copying an object to the collection it\\'s already part of is not supported')\n\t\t}\n\t\tif (!this._parent.isSameCollectionTypeAs(collection)) {\n\t\t\tthrow new Error('Copying an object to a collection of a different type is not supported')\n\t\t}\n\t\tif (!collection.isWriteable()) {\n\t\t\tthrow new Error('Can not copy object into read-only destination collection')\n\t\t}\n\n\t\tconst uri = this.url.split('/').splice(-1, 1)[0]\n\t\tconst destination = collection.url + uri\n\n\t\tawait this._request.copy(this.url, destination, 0, overwrite, headers)\n\t\treturn collection.find(uri)\n\t}\n\n\t/**\n\t * moves a DavObject to a different DavCollection\n\t * @param {DavCollection} collection\n\t * @param {boolean} overwrite\n\t * @param headers\n\t * @return {Promise<void>}\n\t */\n\tasync move(collection, overwrite = false, headers = {}) {\n\t\tdebug(`moving ${this.url} from ${this._parent.url} to ${collection.url}`)\n\n\t\tif (this._parent === collection) {\n\t\t\tthrow new Error('Moving an object to the collection it\\'s already part of is not supported')\n\t\t}\n\t\tif (!this._parent.isSameCollectionTypeAs(collection)) {\n\t\t\tthrow new Error('Moving an object to a collection of a different type is not supported')\n\t\t}\n\t\tif (!collection.isWriteable()) {\n\t\t\tthrow new Error('Can not move object into read-only destination collection')\n\t\t}\n\n\t\tconst uri = this.url.split('/').splice(-1, 1)[0]\n\t\tconst destination = collection.url + uri\n\n\t\tawait this._request.move(this.url, destination, overwrite, headers)\n\t\tthis._parent = collection\n\t\tthis._url = destination\n\t}\n\n\t/**\n\t * updates the DavObject on the server\n\t * @return {Promise<void>}\n\t */\n\tasync update() {\n\t\t// 1. Do not update filtered objects, because we would be loosing data on the server\n\t\t// 2. No need to update if object was never modified\n\t\t// 3. Do not update if called directly on DavObject, because there is no data prop\n\t\tif (this.isPartial() || !this.isDirty() || !this.data) {\n\t\t\treturn\n\t\t}\n\n\t\tconst headers = {}\n\n\t\t// updating an object should use it's content-type\n\t\tif (this.contenttype) {\n\t\t\theaders['Content-Type'] = `${this.contenttype}; charset=utf-8`\n\t\t}\n\t\tif (this.etag) {\n\t\t\theaders['If-Match'] = this.etag\n\t\t}\n\n\t\treturn this._request.put(this.url, headers, this.data).then((res) => {\n\t\t\tthis._isDirty = false\n\t\t\t// Don't overwrite content-type, it's set to text/html in the response ...\n\t\t\tthis._props['{DAV:}getetag'] = res.xhr.getResponseHeader('etag')\n\t\t}).catch((ex) => {\n\t\t\tthis._isDirty = true\n\n\t\t\tif (ex instanceof NetworkRequestClientError && ex.status === 412) {\n\t\t\t\tthis._isPartial = true\n\t\t\t}\n\n\t\t\tthrow ex\n\t\t})\n\t}\n\n\t/**\n\t * deletes the DavObject on the server\n\t *\n\t * @param headers\n\t * @return {Promise<void>}\n\t */\n\tasync delete(headers = {}) {\n\t\treturn this._request.delete(this.url, headers)\n\t}\n\n\t/**\n\t * returns whether the data in this DavObject is the result of a partial retrieval\n\t *\n\t * @return {boolean}\n\t */\n\tisPartial() {\n\t\treturn this._isPartial\n\t}\n\n\t/**\n\t * returns whether the data in this DavObject contains unsynced changes\n\t *\n\t * @return {boolean}\n\t */\n\tisDirty() {\n\t\treturn this._isDirty\n\t}\n\n\t/**\n\t * @protected\n\t * @param {string} localName\n\t * @param {string} xmlNamespace\n\t * @param {string} xmlName\n\t * @param {boolean} mutable\n\t * @return void\n\t */\n\t_exposeProperty(localName, xmlNamespace, xmlName, mutable = false) {\n\t\tif (mutable) {\n\t\t\tObject.defineProperty(this, localName, {\n\t\t\t\tget: () => this._props[`{${xmlNamespace}}${xmlName}`],\n\t\t\t\tset: (val) => {\n\t\t\t\t\tthis._isDirty = true\n\t\t\t\t\tthis._props[`{${xmlNamespace}}${xmlName}`] = val\n\t\t\t\t},\n\t\t\t})\n\t\t} else {\n\t\t\tObject.defineProperty(this, localName, {\n\t\t\t\tget: () => this._props[`{${xmlNamespace}}${xmlName}`],\n\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * A list of all property names that should be included\n\t * in propfind requests that may include this object\n\t *\n\t * @return {string[][]}\n\t */\n\tstatic getPropFindList() {\n\t\treturn [\n\t\t\t[NS.DAV, 'getcontenttype'],\n\t\t\t[NS.DAV, 'getetag'],\n\t\t\t[NS.DAV, 'resourcetype'],\n\t\t]\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as NS from '../utility/namespaceUtility.js'\nimport * as StringUtility from '../utility/stringUtility.js'\nimport * as XMLUtility from '../utility/xmlUtility.js'\nimport DAVEventListener from './davEventListener.js'\n\nimport { debugFactory } from '../debug.js'\nimport davCollectionPropSet from '../propset/davCollectionPropSet.js'\nimport { DavObject } from './davObject.js'\nconst debug = debugFactory('DavCollection')\n\nexport class DavCollection extends DAVEventListener {\n\n\t/**\n\t * @param {object} parent\n\t * @param {Request} request\n\t * @param {string} url\n\t * @param {object} props\n\t */\n\tconstructor(parent, request, url, props) {\n\t\tsuper()\n\n\t\t// This is a collection, so always make sure to end with a /\n\t\tif (url.slice(-1) !== '/') {\n\t\t\turl += '/'\n\t\t}\n\n\t\tObject.assign(this, {\n\t\t\t// parameters\n\t\t\t_parent: parent,\n\t\t\t_request: request,\n\t\t\t_url: url,\n\t\t\t_props: props,\n\t\t\t// constructors\n\t\t\t_collectionFactoryMapper: {},\n\t\t\t_objectFactoryMapper: {},\n\t\t\t// house keeping\n\t\t\t_updatedProperties: [],\n\t\t\t_childrenNames: [],\n\n\t\t\t// parsers / factories\n\t\t\t_propFindList: [],\n\t\t\t_propSetFactory: [],\n\n\t\t})\n\n\t\tthis._registerPropSetFactory(davCollectionPropSet)\n\n\t\tthis._exposeProperty('displayname', NS.DAV, 'displayname', true)\n\t\tthis._exposeProperty('owner', NS.DAV, 'owner')\n\t\tthis._exposeProperty('resourcetype', NS.DAV, 'resourcetype')\n\t\tthis._exposeProperty('syncToken', NS.DAV, 'sync-token')\n\t\tthis._exposeProperty('currentUserPrivilegeSet', NS.DAV, 'current-user-privilege-set')\n\n\t\tObject.defineProperty(this, 'url', {\n\t\t\tget: () => this._url,\n\t\t})\n\n\t\tthis._propFindList.push(...DavObject.getPropFindList())\n\t\tthis._propFindList.push(...DavCollection.getPropFindList())\n\t}\n\n\t/**\n\t * finds all children of a collection\n\t *\n\t * @return {Promise<DavObject[]|DavCollection[]>}\n\t */\n\tasync findAll() {\n\t\tconst response = await this._request.propFind(this._url, this._propFindList, 1)\n\t\treturn this._handleMultiStatusResponse(response, false)\n\t}\n\n\t/**\n\t * finds all children of a collection filtered by filter\n\t *\n\t * @param {Function} filter\n\t * @return {Promise<DavObject[]|DavCollection[]>}\n\t */\n\tasync findAllByFilter(filter) {\n\t\tconst all = await this.findAll()\n\t\treturn all.filter(filter)\n\t}\n\n\t/**\n\t * find one object by its uri\n\t *\n\t * @param {string} uri\n\t * @return {Promise<DavObject|DavCollection>}\n\t */\n\tasync find(uri) {\n\t\tconst response = await this._request.propFind(this._url + uri, this._propFindList, 0)\n\t\tresponse.body = { [this._url + uri]: response.body }\n\t\treturn this._handleMultiStatusResponse(response, false)[0]\n\t}\n\n\t/**\n\t * creates a new webdav collection\n\t * https://tools.ietf.org/html/rfc5689\n\t *\n\t * You usually don't want to call this method directly\n\t * but instead use:\n\t * - AddressBookHome->createAddressBookCollection\n\t * - CalendarHome->createCalendarCollection\n\t * - CalendarHome->createSubscribedCollection\n\t *\n\t * @param {string} name\n\t * @param {?Array} props\n\t * @return {Promise<DavCollection>}\n\t */\n\tasync createCollection(name, props = null) {\n\t\tdebug('creating a collection')\n\n\t\tif (!props) {\n\t\t\tprops = [{\n\t\t\t\tname: [NS.DAV, 'resourcetype'],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.DAV, 'collection'],\n\t\t\t\t}],\n\t\t\t}]\n\t\t}\n\n\t\tconst [skeleton, dPropChildren] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.DAV, 'mkcol'],\n\t\t\t[NS.DAV, 'set'],\n\t\t\t[NS.DAV, 'prop'],\n\t\t)\n\n\t\tdPropChildren.push(...props)\n\n\t\tconst uri = this._getAvailableNameFromToken(name)\n\t\tconst data = XMLUtility.serialize(skeleton)\n\t\tawait this._request.mkCol(this.url + uri, {}, data)\n\t\treturn this.find(uri + '/')\n\t}\n\n\t/**\n\t * creates a new webdav object inside this collection\n\t *\n\t * You usually don't want to call this method directly\n\t * but instead use:\n\t * - AddressBook->createVCard\n\t * - Calendar->createVObject\n\t *\n\t * @param {string} name\n\t * @param {object} headers\n\t * @param {string} data\n\t * @return {Promise<DavObject>}\n\t */\n\tasync createObject(name, headers, data) {\n\t\tdebug('creating an object')\n\n\t\tawait this._request.put(this.url + name, headers, data)\n\t\treturn this.find(name)\n\t}\n\n\t/**\n\t * sends a PropPatch request to update the collections' properties\n\t * The request is only made if properties actually changed\n\t *\n\t * @return {Promise<void>}\n\t */\n\tasync update() {\n\t\tif (this._updatedProperties.length === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tconst properties = {}\n\t\tthis._updatedProperties.forEach((updatedProperty) => {\n\t\t\tproperties[updatedProperty] = this._props[updatedProperty]\n\t\t})\n\t\tconst propSet = this._propSetFactory.reduce((arr, p) => [...arr, ...p(properties)], [])\n\n\t\tconst [skeleton, dPropSet] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.DAV, 'propertyupdate'],\n\t\t\t[NS.DAV, 'set'],\n\t\t\t[NS.DAV, 'prop'])\n\n\t\tdPropSet.push(...propSet)\n\n\t\tconst body = XMLUtility.serialize(skeleton)\n\t\tawait this._request.propPatch(this._url, {}, body)\n\t}\n\n\t/**\n\t * deletes the DavCollection on the server\n\t *\n\t * @param {object} headers - additional HTTP headers to send\n\t * @return {Promise<void>}\n\t */\n\tasync delete(headers = {}) {\n\t\tawait this._request.delete(this._url, headers)\n\t}\n\n\t/**\n\t *\n\t * @return {boolean}\n\t */\n\tisReadable() {\n\t\treturn this.currentUserPrivilegeSet.includes('{DAV:}read')\n\t}\n\n\t/**\n\t *\n\t * @return {boolean}\n\t */\n\tisWriteable() {\n\t\treturn this.currentUserPrivilegeSet.includes('{DAV:}write')\n\t}\n\n\t/**\n\t * checks whether this is of the same type as another collection\n\t * @param {DavCollection} collection\n\t */\n\tisSameCollectionTypeAs(collection) {\n\t\tconst ownResourceType = this.resourcetype\n\t\tconst foreignResourceType = collection.resourcetype\n\n\t\tconst ownDiff = ownResourceType.find((r) => foreignResourceType.indexOf(r) === -1)\n\t\tconst foreignDiff = foreignResourceType.find((r) => ownResourceType.indexOf(r) === -1)\n\n\t\treturn ownDiff === undefined && foreignDiff === undefined\n\t}\n\n\t/**\n\t * @protected\n\t * @param {string} identifier\n\t * @param {Function} factory\n\t * @return void\n\t */\n\t_registerCollectionFactory(identifier, factory) {\n\t\tthis._collectionFactoryMapper[identifier] = factory\n\t\tif (typeof factory.getPropFindList === 'function') {\n\t\t\tthis._propFindList.push(...factory.getPropFindList())\n\t\t}\n\t}\n\n\t/**\n\t * @protected\n\t * @param {string} identifier\n\t * @param {Function} factory\n\t * @return void\n\t */\n\t_registerObjectFactory(identifier, factory) {\n\t\tthis._objectFactoryMapper[identifier] = factory\n\t\tif (typeof factory.getPropFindList === 'function') {\n\t\t\tthis._propFindList.push(...factory.getPropFindList())\n\t\t}\n\t}\n\n\t/**\n\t * @protected\n\t * @param factory\n\t * @return void\n\t */\n\t_registerPropSetFactory(factory) {\n\t\tthis._propSetFactory.push(factory)\n\t}\n\n\t/**\n\t * @protected\n\t * @param {string} localName\n\t * @param {string} xmlNamespace\n\t * @param {string} xmlName\n\t * @param {boolean} mutable\n\t * @return void\n\t */\n\t_exposeProperty(localName, xmlNamespace, xmlName, mutable = false) {\n\t\tif (mutable) {\n\t\t\tObject.defineProperty(this, localName, {\n\t\t\t\tget: () => this._props[`{${xmlNamespace}}${xmlName}`],\n\t\t\t\tset: (val) => {\n\t\t\t\t\tthis._props[`{${xmlNamespace}}${xmlName}`] = val\n\t\t\t\t\tif (this._updatedProperties.indexOf(`{${xmlNamespace}}${xmlName}`) === -1) {\n\t\t\t\t\t\tthis._updatedProperties.push(`{${xmlNamespace}}${xmlName}`)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t})\n\t\t} else {\n\t\t\tObject.defineProperty(this, localName, {\n\t\t\t\tget: () => this._props[`{${xmlNamespace}}${xmlName}`],\n\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * @protected\n\t * @param {string} token\n\t * @return {string}\n\t */\n\t_getAvailableNameFromToken(token) {\n\t\treturn StringUtility.uri(token, name => {\n\t\t\treturn this._childrenNames.indexOf(this._url + name) === -1\n\t\t\t\t&& this._childrenNames.indexOf(this._url + name + '/') === -1\n\t\t})\n\t}\n\n\t/**\n\t * get updated properties for this collection from server\n\t * @protected\n\t * @return {object}\n\t */\n\tasync _updatePropsFromServer() {\n\t\tconst response = await this._request.propFind(this.url, this.constructor.getPropFindList())\n\t\tthis._props = response.body\n\t}\n\n\t/**\n\t * @param {object} response\n\t * @param {boolean} isPartial\n\t * @return {DavObject[]|DavCollection[]}\n\t * @protected\n\t */\n\t_handleMultiStatusResponse(response, isPartial = false) {\n\t\tconst index = []\n\t\tconst children = []\n\n\t\tObject.entries(response.body).forEach(([path, props]) => {\n\t\t\t// The DAV Server will always return a propStat\n\t\t\t// block containing properties of the current url\n\t\t\t// we are not interested, so let's filter it out\n\t\t\tif (path === this._url || path + '/' === this.url) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tindex.push(path)\n\t\t\tconst url = this._request.pathname(path)\n\n\t\t\t// empty resourcetype property => this is no collection\n\t\t\tif (((!props['{DAV:}resourcetype']) || (props['{DAV:}resourcetype'].length === 0)) && props['{DAV:}getcontenttype']) {\n\t\t\t\tdebug(`${path} was identified as a file`)\n\n\t\t\t\tconst contentType = props['{DAV:}getcontenttype'].split(';')[0]\n\t\t\t\tif (!this._objectFactoryMapper[contentType]) {\n\t\t\t\t\tdebug(`No constructor for content-type ${contentType} (${path}) registered, treating as generic object`)\n\t\t\t\t\tchildren.push(new DavObject(this, this._request, url, props))\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tchildren.push(new this._objectFactoryMapper[contentType](this, this._request, url, props, isPartial))\n\t\t\t} else {\n\t\t\t\tdebug(`${path} was identified as a collection`)\n\n\t\t\t\t// get first collection type other than DAV collection\n\t\t\t\tconst collectionType = props['{DAV:}resourcetype'].find((r) => {\n\t\t\t\t\treturn r !== `{${NS.DAV}}collection`\n\t\t\t\t})\n\n\t\t\t\tif (!collectionType) {\n\t\t\t\t\tdebug(`Collection-type of ${path} was not specified, treating as generic collection`)\n\t\t\t\t\tchildren.push(new DavCollection(this, this._request, url, props))\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (!this._collectionFactoryMapper[collectionType]) {\n\t\t\t\t\tdebug(`No constructor for collection-type ${collectionType} (${path}) registered, treating as generic collection`)\n\t\t\t\t\tchildren.push(new DavCollection(this, this._request, url, props))\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tchildren.push(new this._collectionFactoryMapper[collectionType](this, this._request, url, props))\n\t\t\t}\n\t\t})\n\n\t\tthis._childrenNames.push(...index)\n\t\treturn children\n\t}\n\n\t/**\n\t * A list of all property names that should be included\n\t * in propfind requests that may include this collection\n\t *\n\t * @return {string[][]}\n\t */\n\tstatic getPropFindList() {\n\t\treturn [\n\t\t\t[NS.DAV, 'displayname'],\n\t\t\t[NS.DAV, 'owner'],\n\t\t\t[NS.DAV, 'resourcetype'],\n\t\t\t[NS.DAV, 'sync-token'],\n\t\t\t[NS.DAV, 'current-user-privilege-set'],\n\t\t]\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as NS from '../utility/namespaceUtility.js'\nimport * as XMLUtility from '../utility/xmlUtility.js'\n\nimport { debugFactory } from '../debug.js'\nconst debug = debugFactory('DavCollectionPublishable')\n\nexport function davCollectionPublishable(Base) {\n\treturn class extends Base {\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tconstructor(...args) {\n\t\t\tsuper(...args)\n\n\t\t\tsuper._exposeProperty('publishURL', NS.CALENDARSERVER, 'publish-url')\n\t\t}\n\n\t\t/**\n\t\t * publishes the DavCollection\n\t\t *\n\t\t * @return {Promise<void>}\n\t\t */\n\t\tasync publish() {\n\t\t\tdebug(`Publishing ${this.url}`)\n\n\t\t\tconst [skeleton] = XMLUtility.getRootSkeleton(\n\t\t\t\t[NS.CALENDARSERVER, 'publish-calendar'])\n\t\t\tconst xml = XMLUtility.serialize(skeleton)\n\n\t\t\t// TODO - ideally the server should return a 'pre-publish-url' as described in the standard\n\n\t\t\tawait this._request.post(this._url, { 'Content-Type': 'application/xml; charset=utf-8' }, xml)\n\t\t\tawait this._updatePropsFromServer()\n\t\t}\n\n\t\t/**\n\t\t * unpublishes the DavCollection\n\t\t *\n\t\t * @return {Promise<void>}\n\t\t */\n\t\tasync unpublish() {\n\t\t\tdebug(`Unpublishing ${this.url}`)\n\n\t\t\tconst [skeleton] = XMLUtility.getRootSkeleton(\n\t\t\t\t[NS.CALENDARSERVER, 'unpublish-calendar'])\n\t\t\tconst xml = XMLUtility.serialize(skeleton)\n\n\t\t\tawait this._request.post(this._url, { 'Content-Type': 'application/xml; charset=utf-8' }, xml)\n\t\t\tdelete this._props['{http://calendarserver.org/ns/}publish-url']\n\t\t}\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tstatic getPropFindList() {\n\t\t\treturn super.getPropFindList().concat([\n\t\t\t\t[NS.CALENDARSERVER, 'publish-url'],\n\t\t\t])\n\t\t}\n\n\t}\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as NS from '../utility/namespaceUtility.js'\nimport * as XMLUtility from '../utility/xmlUtility.js'\n\nimport { debugFactory } from '../debug.js'\nconst debug = debugFactory('DavCollectionShareable')\n\nexport function davCollectionShareable(Base) {\n\treturn class extends Base {\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tconstructor(...args) {\n\t\t\tsuper(...args)\n\n\t\t\tsuper._exposeProperty('shares', NS.OWNCLOUD, 'invite')\n\t\t\tsuper._exposeProperty('allowedSharingModes', NS.CALENDARSERVER, 'allowed-sharing-modes')\n\t\t}\n\n\t\t/**\n\t\t * shares a DavCollection\n\t\t *\n\t\t * @param {string} principalScheme\n\t\t * @param {boolean} writeable\n\t\t * @param {string} summary\n\t\t * @return {Promise<void>}\n\t\t */\n\t\tasync share(principalScheme, writeable = false, summary = '') {\n\t\t\tdebug(`Sharing ${this.url} with ${principalScheme}`)\n\t\t\tconst [skeleton, setProp] = XMLUtility.getRootSkeleton(\n\t\t\t\t[NS.OWNCLOUD, 'share'], [NS.OWNCLOUD, 'set'])\n\n\t\t\tsetProp.push({\n\t\t\t\tname: [NS.DAV, 'href'],\n\t\t\t\tvalue: principalScheme,\n\t\t\t})\n\n\t\t\tif (writeable) {\n\t\t\t\tsetProp.push({\n\t\t\t\t\tname: [NS.OWNCLOUD, 'read-write'],\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (summary !== '') {\n\t\t\t\tsetProp.push({\n\t\t\t\t\tname: [NS.OWNCLOUD, 'summary'],\n\t\t\t\t\tvalue: summary,\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tconst xml = XMLUtility.serialize(skeleton)\n\t\t\treturn this._request.post(this._url, { 'Content-Type': 'application/xml; charset=utf-8' }, xml).then(() => {\n\t\t\t\tconst index = this.shares.findIndex((e) => e.href === principalScheme)\n\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tthis.shares.push({\n\t\t\t\t\t\thref: principalScheme,\n\t\t\t\t\t\taccess: [writeable ? '{http://owncloud.org/ns}read-write' : '{http://owncloud.org/ns}read'],\n\t\t\t\t\t\t'common-name': null,\n\t\t\t\t\t\t'invite-accepted': true,\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tthis.shares[index].access\n\t\t\t\t\t\t= [writeable ? '{http://owncloud.org/ns}read-write' : '{http://owncloud.org/ns}read']\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\t/**\n\t\t * unshares a DAVCollection\n\t\t *\n\t\t * @param {string} principalScheme\n\t\t * @return {Promise<void>}\n\t\t */\n\t\tasync unshare(principalScheme) {\n\t\t\tdebug(`Unsharing ${this.url} with ${principalScheme}`)\n\n\t\t\tconst [skeleton, oSetChildren] = XMLUtility.getRootSkeleton(\n\t\t\t\t[NS.OWNCLOUD, 'share'], [NS.OWNCLOUD, 'remove'])\n\n\t\t\toSetChildren.push({\n\t\t\t\tname: [NS.DAV, 'href'],\n\t\t\t\tvalue: principalScheme,\n\t\t\t})\n\n\t\t\tconst xml = XMLUtility.serialize(skeleton)\n\t\t\treturn this._request.post(this._url, { 'Content-Type': 'application/xml; charset=utf-8' }, xml).then(() => {\n\t\t\t\tconst index = this.shares.findIndex((e) => e.href === principalScheme)\n\t\t\t\tif (index === -1) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tthis.shares.splice(index, 1)\n\t\t\t})\n\t\t}\n\n\t\t/**\n\t\t * checks whether a collection is shareable\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tisShareable() {\n\t\t\tif (!Array.isArray(this.allowedSharingModes)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\treturn this.allowedSharingModes.includes(`{${NS.CALENDARSERVER}}can-be-shared`)\n\t\t}\n\n\t\t/**\n\t\t * checks whether a collection is publishable\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tisPublishable() {\n\t\t\tif (!Array.isArray(this.allowedSharingModes)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\treturn this.allowedSharingModes.includes(`{${NS.CALENDARSERVER}}can-be-published`)\n\t\t}\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tstatic getPropFindList() {\n\t\t\treturn super.getPropFindList().concat([\n\t\t\t\t[NS.OWNCLOUD, 'invite'],\n\t\t\t\t[NS.CALENDARSERVER, 'allowed-sharing-modes'],\n\t\t\t])\n\t\t}\n\n\t}\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { DavObject } from './davObject.js'\nimport * as NS from '../utility/namespaceUtility.js'\n\n/**\n * @class\n */\nexport class VObject extends DavObject {\n\n\t/**\n\t * Creates a VObject that is supposed to store calendar-data\n\t * as specified in RFC 5545.\n\t *\n\t * https://tools.ietf.org/html/rfc5545\n\t *\n\t * @inheritDoc\n\t */\n\tconstructor(...args) {\n\t\tsuper(...args)\n\n\t\tsuper._exposeProperty('data', NS.IETF_CALDAV, 'calendar-data', true)\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic getPropFindList() {\n\t\treturn super.getPropFindList().concat([\n\t\t\t[NS.IETF_CALDAV, 'calendar-data'],\n\t\t])\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as NS from '../utility/namespaceUtility.js'\n\n/**\n *\n * This function is capable of creating the propset xml structure for:\n * - {http://apple.com/ns/ical/}calendar-order\n * - {http://apple.com/ns/ical/}calendar-color\n * - {http://calendarserver.org/ns/}source\n * - {urn:ietf:params:xml:ns:caldav}calendar-description\n * - {urn:ietf:params:xml:ns:caldav}calendar-timezone\n * - {http://owncloud.org/ns}calendar-enabled\n *\n * @param {object} props\n * @return {object}\n */\nexport default function calendarPropSet(props) {\n\tconst xmlified = []\n\n\tObject.entries(props).forEach(([key, value]) => {\n\t\tswitch (key) {\n\t\tcase '{http://apple.com/ns/ical/}calendar-order':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.APPLE, 'calendar-order'],\n\t\t\t\tvalue: value.toString(),\n\t\t\t})\n\t\t\tbreak\n\n\t\tcase '{http://apple.com/ns/ical/}calendar-color':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.APPLE, 'calendar-color'],\n\t\t\t\tvalue,\n\t\t\t})\n\t\t\tbreak\n\n\t\tcase '{http://calendarserver.org/ns/}source':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.CALENDARSERVER, 'source'],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.DAV, 'href'],\n\t\t\t\t\tvalue,\n\t\t\t\t}],\n\t\t\t})\n\t\t\tbreak\n\n\t\tcase '{urn:ietf:params:xml:ns:caldav}calendar-description':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.IETF_CALDAV, 'calendar-description'],\n\t\t\t\tvalue,\n\t\t\t})\n\t\t\tbreak\n\n\t\tcase '{urn:ietf:params:xml:ns:caldav}calendar-timezone':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.IETF_CALDAV, 'calendar-timezone'],\n\t\t\t\tvalue,\n\t\t\t})\n\t\t\tbreak\n\n\t\tcase '{http://owncloud.org/ns}calendar-enabled':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.OWNCLOUD, 'calendar-enabled'],\n\t\t\t\tvalue: value ? '1' : '0',\n\t\t\t})\n\t\t\tbreak\n\t\tcase '{urn:ietf:params:xml:ns:caldav}schedule-calendar-transp':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.IETF_CALDAV, 'schedule-calendar-transp'],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.IETF_CALDAV, value],\n\t\t\t\t}],\n\t\t\t})\n\t\t\tbreak\n\t\tdefault:\n\t\t\tbreak\n\t\t}\n\t})\n\n\treturn xmlified\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { DavCollection } from './davCollection.js'\nimport { davCollectionPublishable } from './davCollectionPublishable.js'\nimport { davCollectionShareable } from './davCollectionShareable.js'\nimport { VObject } from './vobject.js'\nimport calendarPropSet from '../propset/calendarPropSet.js'\nimport * as NS from '../utility/namespaceUtility.js'\nimport * as StringUtility from '../utility/stringUtility.js'\nimport * as XMLUtility from '../utility/xmlUtility.js'\n\nimport { debugFactory } from '../debug.js'\nconst debug = debugFactory('Calendar')\n\n/**\n * This class represents an calendar collection as specified in\n * https://tools.ietf.org/html/rfc4791#section-4.2\n *\n * On top of all the properties provided by davCollectionShareable,\n * davCollectionPublishable and DavCollection,\n * It allows you access to the following list of properties:\n * - color\n * - enabled\n * - order\n * - timezone\n * - components\n *\n * The first four allowing read-write access\n *\n * @augments DavCollection\n */\nexport class Calendar extends davCollectionPublishable(davCollectionShareable(DavCollection)) {\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(...args) {\n\t\tsuper(...args)\n\n\t\tsuper._registerObjectFactory('text/calendar', VObject)\n\t\tsuper._registerPropSetFactory(calendarPropSet)\n\n\t\tsuper._exposeProperty('color', NS.APPLE, 'calendar-color', true)\n\t\tsuper._exposeProperty('enabled', NS.OWNCLOUD, 'calendar-enabled', true)\n\t\tsuper._exposeProperty('order', NS.APPLE, 'calendar-order', true)\n\t\tsuper._exposeProperty('timezone', NS.IETF_CALDAV, 'calendar-timezone', true)\n\t\tsuper._exposeProperty('components', NS.IETF_CALDAV, 'supported-calendar-component-set')\n\t\tsuper._exposeProperty('transparency', NS.IETF_CALDAV, 'schedule-calendar-transp', true)\n\t}\n\n\t/**\n\t * finds all VObjects in this calendar\n\t *\n\t * @return {Promise<VObject[]>}\n\t */\n\tasync findAllVObjects() {\n\t\treturn super.findAllByFilter((elm) => elm instanceof VObject)\n\t}\n\n\t/**\n\t * find all VObjects filtered by type\n\t *\n\t * @param {string} type\n\t * @return {Promise<VObject[]>}\n\t */\n\tasync findByType(type) {\n\t\treturn this.calendarQuery([{\n\t\t\tname: [NS.IETF_CALDAV, 'comp-filter'],\n\t\t\tattributes: [\n\t\t\t\t['name', 'VCALENDAR'],\n\t\t\t],\n\t\t\tchildren: [{\n\t\t\t\tname: [NS.IETF_CALDAV, 'comp-filter'],\n\t\t\t\tattributes: [\n\t\t\t\t\t['name', type],\n\t\t\t\t],\n\t\t\t}],\n\t\t}])\n\t}\n\n\t/**\n\t * find all VObjects in a time-range filtered by type\n\t *\n\t * @param {number} type\n\t * @param {Date} from\n\t * @param {Date} to\n\t * @return {Promise<VObject[]>}\n\t */\n\tasync findByTypeInTimeRange(type, from, to) {\n\t\treturn this.calendarQuery([{\n\t\t\tname: [NS.IETF_CALDAV, 'comp-filter'],\n\t\t\tattributes: [\n\t\t\t\t['name', 'VCALENDAR'],\n\t\t\t],\n\t\t\tchildren: [{\n\t\t\t\tname: [NS.IETF_CALDAV, 'comp-filter'],\n\t\t\t\tattributes: [\n\t\t\t\t\t['name', type],\n\t\t\t\t],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.IETF_CALDAV, 'time-range'],\n\t\t\t\t\tattributes: [\n\t\t\t\t\t\t['start', Calendar._getICalendarDateTimeFromDateObject(from)],\n\t\t\t\t\t\t['end', Calendar._getICalendarDateTimeFromDateObject(to)],\n\t\t\t\t\t],\n\t\t\t\t}],\n\t\t\t}],\n\t\t}])\n\t}\n\n\t/**\n\t * create a VObject inside this calendar\n\t *\n\t * @param data\n\t * @return {Promise<VObject>}\n\t */\n\tasync createVObject(data) {\n\t\tconst name = StringUtility.uid('', 'ics')\n\t\tconst headers = {\n\t\t\t'Content-Type': 'text/calendar; charset=utf-8',\n\t\t}\n\n\t\treturn super.createObject(name, headers, data)\n\t}\n\n\t/**\n\t * sends a calendar query as defined in\n\t * https://tools.ietf.org/html/rfc4791#section-7.8\n\t *\n\t * @param {object[]} filter\n\t * @param {object[]} prop\n\t * @param {string} timezone\n\t * @return {Promise<VObject[]>}\n\t */\n\tasync calendarQuery(filter, prop = null, timezone = null) {\n\t\tdebug('sending an calendar-query request')\n\n\t\tconst [skeleton] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.IETF_CALDAV, 'calendar-query'],\n\t\t)\n\n\t\tif (!prop) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\tchildren: this._propFindList.map((p) => ({ name: p })),\n\t\t\t})\n\t\t} else {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\tchildren: prop,\n\t\t\t})\n\t\t}\n\n\t\t// According to the spec, every calendar-query needs a filter,\n\t\t// but Nextcloud just returns all elements without a filter.\n\t\tif (filter) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.IETF_CALDAV, 'filter'],\n\t\t\t\tchildren: filter,\n\t\t\t})\n\t\t}\n\n\t\tif (timezone) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.IETF_CALDAV, 'timezone'],\n\t\t\t\tvalue: timezone,\n\t\t\t})\n\t\t}\n\n\t\tconst headers = {\n\t\t\tDepth: '1',\n\t\t}\n\n\t\tconst body = XMLUtility.serialize(skeleton)\n\t\tconst response = await this._request.report(this.url, headers, body)\n\t\treturn super._handleMultiStatusResponse(response, Calendar._isRetrievalPartial(prop))\n\t}\n\n\t/**\n\t * sends a calendar multiget query as defined in\n\t * https://tools.ietf.org/html/rfc4791#section-7.9\n\t *\n\t * @param {string[]} hrefs\n\t * @param {object[]} prop\n\t * @return {Promise<VObject[]>}\n\t */\n\tasync calendarMultiget(hrefs = [], prop) {\n\t\tdebug('sending an calendar-multiget request')\n\n\t\tif (hrefs.length === 0) {\n\t\t\treturn []\n\t\t}\n\n\t\tconst [skeleton] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.IETF_CALDAV, 'calendar-multiget'],\n\t\t)\n\n\t\tif (!prop) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\tchildren: this._propFindList.map((p) => ({ name: p })),\n\t\t\t})\n\t\t} else {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\tchildren: prop,\n\t\t\t})\n\t\t}\n\n\t\threfs.forEach((href) => {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'href'],\n\t\t\t\tvalue: href,\n\t\t\t})\n\t\t})\n\n\t\tconst headers = {\n\t\t\tDepth: '1',\n\t\t}\n\t\tconst body = XMLUtility.serialize(skeleton)\n\t\tconst response = await this._request.report(this.url, headers, body)\n\t\treturn super._handleMultiStatusResponse(response, Calendar._isRetrievalPartial(prop))\n\t}\n\n\t/**\n\t * sends a calendar free-busy-query as defined in\n\t * https://tools.ietf.org/html/rfc4791#section-7.10\n\t *\n\t * @param {Date} from\n\t * @param {Date} to\n\t * @return {Promise<string>}\n\t */\n\tasync freeBusyQuery(from, to) {\n\t\t/* eslint-disable no-tabs */\n\t\t// debug('sending a free-busy-query request');\n\t\t//\n\t\t// const [skeleton] = XMLUtility.getRootSkeleton(\n\t\t// \t[NS.IETF_CALDAV, 'free-busy-query'],\n\t\t// \t[NS.IETF_CALDAV, 'time-range']\n\t\t// );\n\t\t//\n\t\t// skeleton[0][0].attributes.push(['start', Calendar._getICalendarDateTimeFromDateObject(from)]);\n\t\t// skeleton[0][0].attributes.push(['end', Calendar._getICalendarDateTimeFromDateObject(to)]);\n\t\t//\n\t\t// const headers = {\n\t\t// \t'Depth': '1'\n\t\t// };\n\t\t// const body = XMLUtility.serialize(skeleton);\n\t\t// const response = await this._request.report(this.url, headers, body);\n\t\t/* eslint-enable no-tabs */\n\n\t\t// TODO - finish implementation\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic getPropFindList() {\n\t\treturn super.getPropFindList().concat([\n\t\t\t[NS.APPLE, 'calendar-order'],\n\t\t\t[NS.APPLE, 'calendar-color'],\n\t\t\t[NS.CALENDARSERVER, 'getctag'],\n\t\t\t[NS.IETF_CALDAV, 'calendar-description'],\n\t\t\t[NS.IETF_CALDAV, 'calendar-timezone'],\n\t\t\t[NS.IETF_CALDAV, 'supported-calendar-component-set'],\n\t\t\t[NS.IETF_CALDAV, 'supported-calendar-data'],\n\t\t\t[NS.IETF_CALDAV, 'max-resource-size'],\n\t\t\t[NS.IETF_CALDAV, 'min-date-time'],\n\t\t\t[NS.IETF_CALDAV, 'max-date-time'],\n\t\t\t[NS.IETF_CALDAV, 'max-instances'],\n\t\t\t[NS.IETF_CALDAV, 'max-attendees-per-instance'],\n\t\t\t[NS.IETF_CALDAV, 'supported-collation-set'],\n\t\t\t[NS.IETF_CALDAV, 'calendar-free-busy-set'],\n\t\t\t[NS.IETF_CALDAV, 'schedule-calendar-transp'],\n\t\t\t[NS.IETF_CALDAV, 'schedule-default-calendar-URL'],\n\t\t\t[NS.OWNCLOUD, 'calendar-enabled'],\n\t\t\t[NS.NEXTCLOUD, 'owner-displayname'],\n\t\t\t[NS.NEXTCLOUD, 'trash-bin-retention-duration'],\n\t\t\t[NS.NEXTCLOUD, 'deleted-at'],\n\t\t])\n\t}\n\n\t/**\n\t * checks if the prop part of a report requested partial data\n\t *\n\t * @param {object[]} prop\n\t * @return {boolean}\n\t * @private\n\t */\n\tstatic _isRetrievalPartial(prop) {\n\t\tif (!prop) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst addressBookDataProperty = prop.find((p) => {\n\t\t\treturn p.name[0] === NS.IETF_CALDAV && p.name[1] === 'calendar-data'\n\t\t})\n\n\t\tif (!addressBookDataProperty) {\n\t\t\treturn false\n\t\t}\n\n\t\treturn !!addressBookDataProperty.children\n\t}\n\n\t/**\n\t * creates an iCalendar formatted DATE-TIME string from a date object\n\t *\n\t * @param {Date} date\n\t * @return {string}\n\t * @private\n\t */\n\tstatic _getICalendarDateTimeFromDateObject(date) {\n\t\treturn [\n\t\t\tdate.getUTCFullYear(),\n\t\t\t('0' + (date.getUTCMonth() + 1)).slice(-2),\n\t\t\t('0' + date.getUTCDate()).slice(-2),\n\t\t\t'T',\n\t\t\t('0' + date.getUTCHours()).slice(-2),\n\t\t\t('0' + date.getUTCMinutes()).slice(-2),\n\t\t\t('0' + date.getUTCSeconds()).slice(-2),\n\t\t\t'Z',\n\t\t].join('')\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { Calendar } from './calendar.js'\nimport * as NS from '../utility/namespaceUtility.js'\n\n/**\n * This class represents a subscription collection\n * It is being cached on the Nextcloud server and allows to be queried by standard CalDAV requests.\n *\n * On top of that it contains more non-standard apple properties\n */\nexport class Subscription extends Calendar {\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(...args) {\n\t\tsuper(...args)\n\n\t\tsuper._exposeProperty('source', NS.CALENDARSERVER, 'source', true)\n\t\tsuper._exposeProperty('refreshRate', NS.APPLE, 'refreshrate', true)\n\t\tsuper._exposeProperty('stripTodos', NS.CALENDARSERVER, 'subscribed-strip-todos', true)\n\t\tsuper._exposeProperty('stripAlarms', NS.CALENDARSERVER, 'subscribed-strip-alarms', true)\n\t\tsuper._exposeProperty('stripAttachments', NS.CALENDARSERVER, 'subscribed-strip-attachments', true)\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic getPropFindList() {\n\t\treturn super.getPropFindList().concat([\n\t\t\t[NS.CALENDARSERVER, 'source'],\n\t\t\t[NS.APPLE, 'refreshrate'],\n\t\t\t[NS.CALENDARSERVER, 'subscribed-strip-todos'],\n\t\t\t[NS.CALENDARSERVER, 'subscribed-strip-alarms'],\n\t\t\t[NS.CALENDARSERVER, 'subscribed-strip-attachments'],\n\t\t])\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as NS from '../utility/namespaceUtility.js'\n\n/**\n * This function is capable of creating the propset xml structure for:\n * - {urn:ietf:params:xml:ns:caldav}calendar-availability\n *\n * @param {object} props\n * @return {object}\n */\nexport default function calendarPropSet(props) {\n\tconst xmlified = []\n\n\tObject.entries(props).forEach(([key, value]) => {\n\t\tswitch (key) {\n\t\tcase '{urn:ietf:params:xml:ns:caldav}calendar-availability':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.IETF_CALDAV, 'calendar-availability'],\n\t\t\t\tvalue: value.toString(),\n\t\t\t})\n\t\t\tbreak\n\t\t}\n\t})\n\n\treturn xmlified\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { Calendar } from './calendar.js'\nimport * as NS from '../utility/namespaceUtility.js'\nimport scheduleInboxPropSet from '../propset/scheduleInboxPropSet.js'\n\nexport default class ScheduleInbox extends Calendar {\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(...args) {\n\t\tsuper(...args)\n\n\t\tsuper._registerPropSetFactory(scheduleInboxPropSet)\n\n\t\t// https://tools.ietf.org/html/rfc7953#section-7.2.4\n\t\tsuper._exposeProperty('availability', NS.IETF_CALDAV, 'calendar-availability', true)\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic getPropFindList() {\n\t\treturn super.getPropFindList().concat([\n\t\t\t[NS.IETF_CALDAV, 'calendar-availability'],\n\t\t])\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { DavCollection } from './davCollection.js'\nimport * as NS from '../utility/namespaceUtility.js'\n\nexport default class ScheduleOutbox extends DavCollection {\n\n\t/**\n\t * Sends a free-busy-request for the scheduling outbox\n\t * The data is required to be a valid iTIP data.\n\t * For an example, see https://tools.ietf.org/html/rfc6638#appendix-B.5\n\t *\n\t * @param {string} data iTIP with VFREEBUSY component and METHOD:REQUEST\n\t * @return {Promise<string[]>}\n\t */\n\tasync freeBusyRequest(data) {\n\t\tconst result = {}\n\t\tconst response = await this._request.post(this.url, {\n\t\t\t'Content-Type': 'text/calendar; charset=\"utf-8\"',\n\t\t}, data)\n\n\t\tconst domParser = new DOMParser()\n\t\tconst document = domParser.parseFromString(response.body, 'application/xml')\n\n\t\tconst responses = document.evaluate('/cl:schedule-response/cl:response', document, NS.resolve, XPathResult.ANY_TYPE, null)\n\t\tlet responseNode\n\n\t\twhile ((responseNode = responses.iterateNext()) !== null) {\n\t\t\tconst recipient = document.evaluate('string(cl:recipient/d:href)', responseNode, NS.resolve, XPathResult.ANY_TYPE, null).stringValue\n\t\t\tconst status = document.evaluate('string(cl:request-status)', responseNode, NS.resolve, XPathResult.ANY_TYPE, null).stringValue\n\t\t\tconst calendarData = document.evaluate('string(cl:calendar-data)', responseNode, NS.resolve, XPathResult.ANY_TYPE, null).stringValue\n\t\t\tconst success = /^2.\\d(;.+)?$/.test(status)\n\n\t\t\tresult[recipient] = {\n\t\t\t\tcalendarData,\n\t\t\t\tstatus,\n\t\t\t\tsuccess,\n\t\t\t}\n\t\t}\n\n\t\treturn result\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { DavCollection } from './davCollection.js'\nimport * as NS from '../utility/namespaceUtility.js'\nimport { VObject } from './vobject.js'\nimport * as XMLUtility from '../utility/xmlUtility.js'\n\nexport class CalendarTrashBin extends DavCollection {\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(...args) {\n\t\tsuper(...args)\n\n\t\tsuper._registerObjectFactory('text/calendar', VObject)\n\n\t\tsuper._exposeProperty('retentionDuration', NS.NEXTCLOUD, 'trash-bin-retention-duration')\n\t}\n\n\tasync findDeletedObjects() {\n\t\tconst [skeleton] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.IETF_CALDAV, 'calendar-query'],\n\t\t)\n\t\tskeleton.children.push({\n\t\t\tname: [NS.DAV, 'prop'],\n\t\t\tchildren: VObject.getPropFindList()\n\t\t\t\t.map((p) => ({ name: p }))\n\t\t\t\t.concat([\n\t\t\t\t\t{ name: [NS.NEXTCLOUD, 'calendar-uri'] },\n\t\t\t\t\t{ name: [NS.NEXTCLOUD, 'deleted-at'] },\n\t\t\t\t]),\n\t\t})\n\t\tskeleton.children.push({\n\t\t\tname: [NS.IETF_CALDAV, 'filter'],\n\t\t\tchildren: [{\n\t\t\t\tname: [NS.IETF_CALDAV, 'comp-filter'],\n\t\t\t\tattributes: [\n\t\t\t\t\t['name', 'VCALENDAR'],\n\t\t\t\t],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.IETF_CALDAV, 'comp-filter'],\n\t\t\t\t\tattributes: [\n\t\t\t\t\t\t['name', 'VEVENT'],\n\t\t\t\t\t],\n\t\t\t\t\tchildren: [],\n\t\t\t\t}],\n\t\t\t}],\n\t\t})\n\t\tconst headers = {\n\t\t\tDepth: '1',\n\t\t}\n\t\tconst body = XMLUtility.serialize(skeleton)\n\t\tconst response = await this._request.report(this._url + 'objects', headers, body)\n\t\treturn super._handleMultiStatusResponse(response)\n\t}\n\n\tasync restore(uri) {\n\t\tawait this._request.move(uri, this._url + 'restore/file')\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2021 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { Calendar } from './calendar.js'\n\n/**\n * This class represents a deleted calendar collection.\n *\n * @augments Calendar\n */\nexport class DeletedCalendar extends Calendar {\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { DavCollection } from './davCollection.js'\nimport { Calendar } from './calendar.js'\nimport { Subscription } from './subscription.js'\nimport ScheduleInbox from './scheduleInbox.js'\nimport ScheduleOutbox from './scheduleOutbox.js'\nimport * as NS from '../utility/namespaceUtility.js'\nimport * as XMLUtility from '../utility/xmlUtility.js'\n\nimport { debugFactory } from '../debug.js'\nimport { CalendarTrashBin } from './calendarTrashBin.js'\nimport { DeletedCalendar } from './deletedCalendar.js'\nconst debug = debugFactory('CalendarHome')\n\n/**\n * This class represents a calendar home as specified in\n * https://tools.ietf.org/html/rfc4791#section-6.2.1\n *\n * As of this versions' release, the Nextcloud server will always\n * return only one calendar home. Despite that, RFC4791 allows\n * a server to return multiple calendar homes though.\n */\nexport class CalendarHome extends DavCollection {\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(...args) {\n\t\tsuper(...args)\n\n\t\tsuper._registerCollectionFactory('{' + NS.IETF_CALDAV + '}calendar', Calendar)\n\t\tsuper._registerCollectionFactory('{' + NS.NEXTCLOUD + '}deleted-calendar', DeletedCalendar)\n\t\tsuper._registerCollectionFactory('{' + NS.CALENDARSERVER + '}subscribed', Subscription)\n\t\tsuper._registerCollectionFactory('{' + NS.IETF_CALDAV + '}schedule-inbox', ScheduleInbox)\n\t\tsuper._registerCollectionFactory('{' + NS.IETF_CALDAV + '}schedule-outbox', ScheduleOutbox)\n\t\tsuper._registerCollectionFactory('{' + NS.NEXTCLOUD + '}trash-bin', CalendarTrashBin)\n\t}\n\n\t/**\n\t * Finds all CalDAV-specific collections in this calendar home\n\t *\n\t * @return {Promise<(Calendar|Subscription|ScheduleInbox|ScheduleOutbox|CalendarTrashBin|DeletedCalendar)[]>}\n\t */\n\tasync findAllCalDAVCollections() {\n\t\treturn super.findAllByFilter((elm) => elm instanceof Calendar || elm instanceof CalendarTrashBin\n\t\t\t|| elm instanceof Subscription || elm instanceof ScheduleInbox || elm instanceof ScheduleOutbox\n\t\t\t|| elm instanceof DeletedCalendar)\n\t}\n\n\t/**\n\t * Finds all CalDAV-specific collections in this calendar home, grouped by type\n\t *\n\t * @return {Promise<{\n\t\t\tcalendars: Calendar[],\n\t\t\tdeletedCalendars: DeletedCalendar[],\n\t\t\ttrashBins: CalendarTrashBin[],\n\t\t\tsubscriptions: Subscription[],\n\t\t\tscheduleInboxes: ScheduleInbox[],\n\t\t\tscheduleOutboxes: ScheduleOutbox[],\n\t\t}>}\n\t */\n\tasync findAllCalDAVCollectionsGrouped() {\n\t\tconst collections = await super.findAll()\n\n\t\treturn {\n\t\t\tcalendars: collections.filter(c => c instanceof Calendar && !(c instanceof ScheduleInbox) && !(c instanceof Subscription) && !(c instanceof DeletedCalendar)),\n\t\t\tdeletedCalendars: collections.filter(c => c instanceof DeletedCalendar),\n\t\t\ttrashBins: collections.filter(c => c instanceof CalendarTrashBin),\n\t\t\tsubscriptions: collections.filter(c => c instanceof Subscription),\n\t\t\tscheduleInboxes: collections.filter(c => c instanceof ScheduleInbox),\n\t\t\tscheduleOutboxes: collections.filter(c => c instanceof ScheduleOutbox),\n\t\t}\n\t}\n\n\t/**\n\t * finds all calendars in this calendar home\n\t *\n\t * @return {Promise<Calendar[]>}\n\t */\n\tasync findAllCalendars() {\n\t\treturn super.findAllByFilter((elm) => elm instanceof Calendar && !(elm instanceof ScheduleInbox) && !(elm instanceof Subscription) && !(elm instanceof DeletedCalendar))\n\t}\n\n\t/**\n\t * Finds all deleted calendars in this calendar home\n\t *\n\t * @return {Promise<DeletedCalendar[]>}\n\t */\n\tasync findAllDeletedCalendars() {\n\t\treturn super.findAllByFilter((elm) => elm instanceof DeletedCalendar)\n\t}\n\n\t/**\n\t * finds all subscriptions in this calendar home\n\t *\n\t * @return {Promise<Subscription[]>}\n\t */\n\tasync findAllSubscriptions() {\n\t\treturn super.findAllByFilter((elm) => elm instanceof Subscription)\n\t}\n\n\t/**\n\t * finds all schedule inboxes in this calendar home\n\t *\n\t * @return {Promise<ScheduleInbox[]>}\n\t */\n\tasync findAllScheduleInboxes() {\n\t\treturn super.findAllByFilter((elm) => elm instanceof ScheduleInbox)\n\t}\n\n\t/**\n\t * finds all schedule outboxes in this calendar home\n\t *\n\t * @return {Promise<ScheduleOutbox[]>}\n\t */\n\tasync findAllScheduleOutboxes() {\n\t\treturn super.findAllByFilter((elm) => elm instanceof ScheduleOutbox)\n\t}\n\n\t/**\n\t * creates a new calendar collection\n\t *\n\t * @param {string} displayname\n\t * @param {string} color\n\t * @param {string[]} supportedComponentSet\n\t * @param {number} order\n\t * @param {string=} timezone\n\t * @return {Promise<Calendar>}\n\t */\n\tasync createCalendarCollection(displayname, color, supportedComponentSet = null, order = null, timezone = null) {\n\t\tdebug('creating a calendar collection')\n\n\t\tconst props = [{\n\t\t\tname: [NS.DAV, 'resourcetype'],\n\t\t\tchildren: [{\n\t\t\t\tname: [NS.DAV, 'collection'],\n\t\t\t}, {\n\t\t\t\tname: [NS.IETF_CALDAV, 'calendar'],\n\t\t\t}],\n\t\t}, {\n\t\t\tname: [NS.DAV, 'displayname'],\n\t\t\tvalue: displayname,\n\t\t}, {\n\t\t\tname: [NS.APPLE, 'calendar-color'],\n\t\t\tvalue: color,\n\t\t}, {\n\t\t\tname: [NS.OWNCLOUD, 'calendar-enabled'],\n\t\t\tvalue: '1',\n\t\t}]\n\n\t\tif (timezone) {\n\t\t\tprops.push({\n\t\t\t\tname: [NS.IETF_CALDAV, 'calendar-timezone'],\n\t\t\t\tvalue: timezone,\n\t\t\t})\n\t\t}\n\n\t\tif (supportedComponentSet) {\n\t\t\tprops.push({\n\t\t\t\tname: [NS.IETF_CALDAV, 'supported-calendar-component-set'],\n\t\t\t\tchildren: supportedComponentSet.map((supportedComponent) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: [NS.IETF_CALDAV, 'comp'],\n\t\t\t\t\t\tattributes: [\n\t\t\t\t\t\t\t['name', supportedComponent],\n\t\t\t\t\t\t],\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t})\n\t\t}\n\n\t\tif (order) {\n\t\t\tprops.push({\n\t\t\t\tname: [NS.APPLE, 'calendar-order'],\n\t\t\t\tvalue: order,\n\t\t\t})\n\t\t}\n\n\t\tconst name = super._getAvailableNameFromToken(displayname)\n\t\treturn super.createCollection(name, props)\n\t}\n\n\t/**\n\t * creates a new subscription\n\t *\n\t * @param {string} displayname\n\t * @param {string} color\n\t * @param {string} source\n\t * @param {number} order\n\t * @return {Promise<Subscription>}\n\t */\n\tasync createSubscribedCollection(displayname, color, source, order = null) {\n\t\tdebug('creating a subscribed collection')\n\n\t\tconst props = [{\n\t\t\tname: [NS.DAV, 'resourcetype'],\n\t\t\tchildren: [{\n\t\t\t\tname: [NS.DAV, 'collection'],\n\t\t\t}, {\n\t\t\t\tname: [NS.CALENDARSERVER, 'subscribed'],\n\t\t\t}],\n\t\t}, {\n\t\t\tname: [NS.DAV, 'displayname'],\n\t\t\tvalue: displayname,\n\t\t}, {\n\t\t\tname: [NS.APPLE, 'calendar-color'],\n\t\t\tvalue: color,\n\t\t}, {\n\t\t\tname: [NS.OWNCLOUD, 'calendar-enabled'],\n\t\t\tvalue: '1',\n\t\t}, {\n\t\t\tname: [NS.CALENDARSERVER, 'source'],\n\t\t\tchildren: [{\n\t\t\t\tname: [NS.DAV, 'href'],\n\t\t\t\tvalue: source,\n\t\t\t}],\n\t\t}]\n\n\t\tif (order) {\n\t\t\tprops.push({\n\t\t\t\tname: [NS.APPLE, 'calendar-order'],\n\t\t\t\tvalue: order,\n\t\t\t})\n\t\t}\n\n\t\tconst name = super._getAvailableNameFromToken(displayname)\n\t\treturn super.createCollection(name, props)\n\t}\n\n\t/**\n\t * Search all calendars the user has access to\n\t * This method makes use of Nextcloud's custom\n\t * calendar Search API\n\t *\n\t * Documentation about that API can be found at: ...\n\t *\n\t * @return {Promise<VObject[]>}\n\t */\n\tasync search() {\n\t\t// TODO - implement me\n\t}\n\n\t/**\n\t * enables the birthday calendar for the Calendar Home that belongs to this user\n\t *\n\t * @return {Promise<void>}\n\t */\n\tasync enableBirthdayCalendar() {\n\t\tconst [skeleton] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.NEXTCLOUD, 'enable-birthday-calendar'],\n\t\t)\n\t\tconst xmlBody = XMLUtility.serialize(skeleton)\n\n\t\tawait this._request.post(this.url, {}, xmlBody)\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as NS from '../utility/namespaceUtility.js'\n\n/**\n *\n * This function is capable of creating the propset xml structure for:\n * - {urn:ietf:params:xml:ns:carddav}addressbook-description\n * - {http://owncloud.org/ns}enabled\n *\n * @param {object} props\n * @return {object}\n */\nexport default function addressBookPropSet(props) {\n\tconst xmlified = []\n\n\tObject.entries(props).forEach(([key, value]) => {\n\t\tswitch (key) {\n\t\tcase '{urn:ietf:params:xml:ns:carddav}addressbook-description':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.IETF_CARDDAV, 'addressbook-description'],\n\t\t\t\tvalue,\n\t\t\t})\n\t\t\tbreak\n\n\t\tcase '{http://owncloud.org/ns}enabled':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.OWNCLOUD, 'enabled'],\n\t\t\t\tvalue: value ? '1' : '0',\n\t\t\t})\n\t\t\tbreak\n\n\t\tdefault:\n\t\t\tbreak\n\t\t}\n\t})\n\n\treturn xmlified\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { DavObject } from './davObject.js'\nimport * as NS from '../utility/namespaceUtility.js'\n\n/**\n * @class\n */\nexport class VCard extends DavObject {\n\n\t/**\n\t * Creates a VCard that is supposed to store address-data\n\t * as specified in RFC 6350.\n\t *\n\t * https://tools.ietf.org/html/rfc6350\n\t *\n\t * @inheritDoc\n\t */\n\tconstructor(...args) {\n\t\tsuper(...args)\n\n\t\tsuper._exposeProperty('data', NS.IETF_CARDDAV, 'address-data', true)\n\t\tsuper._exposeProperty('hasphoto', NS.NEXTCLOUD, 'has-photo', false)\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic getPropFindList() {\n\t\treturn super.getPropFindList().concat([\n\t\t\t[NS.IETF_CARDDAV, 'address-data'],\n\t\t])\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { davCollectionShareable } from './davCollectionShareable.js'\nimport { DavCollection } from './davCollection.js'\nimport * as NS from '../utility/namespaceUtility.js'\nimport * as StringUtility from '../utility/stringUtility.js'\nimport * as XMLUtility from '../utility/xmlUtility.js'\nimport addressBookPropSet from '../propset/addressBookPropSet.js'\nimport { VCard } from './vcard.js'\n\nimport { debugFactory } from '../debug.js'\nconst debug = debugFactory('AddressBook')\n\n/**\n * This class represents an address book collection as specified in\n * https://tools.ietf.org/html/rfc6352#section-5.2\n *\n * On top of all the properties provided by davCollectionShareable and DavCollection,\n * It allows you access to the following list of properties:\n * - description\n * - enabled\n * - readOnly\n *\n * The first two allowing read-write access\n *\n * @augments DavCollection\n */\nexport class AddressBook extends davCollectionShareable(DavCollection) {\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(...args) {\n\t\tsuper(...args)\n\n\t\tsuper._registerObjectFactory('text/vcard', VCard)\n\t\tsuper._registerPropSetFactory(addressBookPropSet)\n\n\t\tsuper._exposeProperty('description', NS.IETF_CARDDAV, 'addressbook-description', true)\n\t\tsuper._exposeProperty('enabled', NS.OWNCLOUD, 'enabled', true)\n\t\tsuper._exposeProperty('readOnly', NS.OWNCLOUD, 'read-only')\n\t}\n\n\t/**\n\t * finds all VCards in this address book\n\t *\n\t * @return {Promise<VCard[]>}\n\t */\n\tfindAllVCards() {\n\t\treturn super.findAllByFilter((elm) => elm instanceof VCard)\n\t}\n\n\t/**\n\t * finds all contacts in an address-book, but with filtered data.\n\t *\n\t * Example use:\n\t * findAllAndFilterBySimpleProperties(['EMAIL', 'UID', 'CATEGORIES', 'FN', 'TEL', 'NICKNAME', 'N'])\n\t *\n\t * @param {string[]} props\n\t * @return {Promise<VCard[]>}\n\t */\n\tasync findAllAndFilterBySimpleProperties(props) {\n\t\tconst children = []\n\t\tprops.forEach((prop) => {\n\t\t\tchildren.push({\n\t\t\t\tname: [NS.IETF_CARDDAV, 'prop'],\n\t\t\t\tattributes: [['name', prop]],\n\t\t\t})\n\t\t})\n\n\t\treturn this.addressbookQuery(null, [{\n\t\t\tname: [NS.DAV, 'getetag'],\n\t\t}, {\n\t\t\tname: [NS.DAV, 'getcontenttype'],\n\t\t}, {\n\t\t\tname: [NS.DAV, 'resourcetype'],\n\t\t}, {\n\t\t\tname: [NS.IETF_CARDDAV, 'address-data'],\n\t\t\tchildren,\n\t\t}, {\n\t\t\tname: [NS.NEXTCLOUD, 'has-photo'],\n\t\t}])\n\t}\n\n\t/**\n\t * creates a new VCard object in this address book\n\t *\n\t * @param {string} data\n\t * @return {Promise<VCard>}\n\t */\n\tasync createVCard(data) {\n\t\tdebug('creating VCard object')\n\n\t\tconst name = StringUtility.uid('', 'vcf')\n\t\tconst headers = {\n\t\t\t'Content-Type': 'text/vcard; charset=utf-8',\n\t\t}\n\n\t\treturn super.createObject(name, headers, data)\n\t}\n\n\t/**\n\t * sends an addressbook query as defined in\n\t * https://tools.ietf.org/html/rfc6352#section-8.6\n\t *\n\t * @param {object[]} filter\n\t * @param {object[]} prop\n\t * @param {number} limit\n\t * @param {string} test Either anyof or allof\n\t * @return {Promise<VCard[]>}\n\t */\n\tasync addressbookQuery(filter, prop = null, limit = null, test = 'anyof') {\n\t\tdebug('sending an addressbook-query request')\n\n\t\tconst [skeleton] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.IETF_CARDDAV, 'addressbook-query'],\n\t\t)\n\n\t\tif (!prop) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\tchildren: this._propFindList.map((p) => ({ name: p })),\n\t\t\t})\n\t\t} else {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\tchildren: prop,\n\t\t\t})\n\t\t}\n\n\t\t// According to the spec, every address-book query needs a filter,\n\t\t// but Nextcloud just returns all elements without a filter.\n\t\tif (filter) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.IETF_CARDDAV, 'filter'],\n\t\t\t\tattributes: [\n\t\t\t\t\t['test', test],\n\t\t\t\t],\n\t\t\t\tchildren: filter,\n\t\t\t})\n\t\t}\n\n\t\tif (limit) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.IETF_CARDDAV, 'limit'],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.IETF_CARDDAV, 'nresults'],\n\t\t\t\t\tvalue: limit,\n\t\t\t\t}],\n\t\t\t})\n\t\t}\n\n\t\tconst headers = {\n\t\t\tDepth: '1',\n\t\t}\n\t\tconst body = XMLUtility.serialize(skeleton)\n\t\tconst response = await this._request.report(this.url, headers, body)\n\t\treturn super._handleMultiStatusResponse(response, AddressBook._isRetrievalPartial(prop))\n\t}\n\n\t/**\n\t * sends an addressbook multiget query as defined in\n\t * https://tools.ietf.org/html/rfc6352#section-8.7\n\t *\n\t * @param {string[]} hrefs\n\t * @param {object[]} prop\n\t * @return {Promise<VCard[]>}\n\t */\n\tasync addressbookMultiget(hrefs = [], prop) {\n\t\tdebug('sending an addressbook-multiget request')\n\n\t\tif (hrefs.length === 0) {\n\t\t\treturn []\n\t\t}\n\n\t\tconst headers = {\n\t\t\tDepth: '1',\n\t\t}\n\t\tconst body = this._buildMultiGetBody(hrefs, prop)\n\t\tconst response = await this._request.report(this.url, headers, body)\n\t\treturn super._handleMultiStatusResponse(response, AddressBook._isRetrievalPartial(prop))\n\t}\n\n\t/**\n\t * sends an addressbook multiget query as defined in\n\t * https://tools.ietf.org/html/rfc6352#section-8.7\n\t * and requests a download of the result\n\t *\n\t * @param {string[]} hrefs\n\t * @param {object[]} prop\n\t * @return {Promise<{Object}>}\n\t * @property {string | object} body\n\t * @property {number} status\n\t * @property {XMLHttpRequest} xhr\n\t */\n\tasync addressbookMultigetExport(hrefs = [], prop) {\n\t\tdebug('sending an addressbook-multiget request and request download')\n\n\t\tif (hrefs.length === 0) {\n\t\t\treturn ''\n\t\t}\n\n\t\tconst headers = {\n\t\t\tDepth: '1',\n\t\t}\n\t\tconst body = this._buildMultiGetBody(hrefs, prop)\n\t\treturn this._request.report(this.url + '?export', headers, body)\n\t}\n\n\t/**\n\t *\n\t * @param {string[]} hrefs\n\t * @param {object[]} prop\n\t * @return String\n\t * @private\n\t */\n\t_buildMultiGetBody(hrefs, prop) {\n\t\tconst [skeleton] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.IETF_CARDDAV, 'addressbook-multiget'],\n\t\t)\n\n\t\tif (!prop) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\tchildren: this._propFindList.map((p) => ({ name: p })),\n\t\t\t})\n\t\t} else {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\tchildren: prop,\n\t\t\t})\n\t\t}\n\n\t\threfs.forEach((href) => {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'href'],\n\t\t\t\tvalue: href,\n\t\t\t})\n\t\t})\n\n\t\treturn XMLUtility.serialize(skeleton)\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic getPropFindList() {\n\t\treturn super.getPropFindList().concat([\n\t\t\t[NS.IETF_CARDDAV, 'addressbook-description'],\n\t\t\t[NS.IETF_CARDDAV, 'supported-address-data'],\n\t\t\t[NS.IETF_CARDDAV, 'max-resource-size'],\n\t\t\t[NS.CALENDARSERVER, 'getctag'],\n\t\t\t[NS.OWNCLOUD, 'enabled'],\n\t\t\t[NS.OWNCLOUD, 'read-only'],\n\t\t])\n\t}\n\n\t/**\n\t * checks if the prop part of a report requested partial data\n\t *\n\t * @param {object[]} prop\n\t * @return {boolean}\n\t * @private\n\t */\n\tstatic _isRetrievalPartial(prop) {\n\t\tif (!prop) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst addressBookDataProperty = prop.find((p) => {\n\t\t\treturn p.name[0] === NS.IETF_CARDDAV && p.name[1] === 'address-data'\n\t\t})\n\n\t\tif (!addressBookDataProperty) {\n\t\t\treturn false\n\t\t}\n\n\t\treturn !!addressBookDataProperty.children\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { DavCollection } from './davCollection.js'\nimport * as NS from '../utility/namespaceUtility.js'\nimport { AddressBook } from './addressBook.js'\n\nimport { debugFactory } from '../debug.js'\nconst debug = debugFactory('AddressBookHome')\n\n/**\n * This class represents an address book home as specified in\n * https://tools.ietf.org/html/rfc6352#section-7.1.1\n *\n * As of this versions' release, the Nextcloud server will always\n * return only one address book home. Despite that, RFC6352 allows\n * a server to return multiple address book homes though.\n */\nexport class AddressBookHome extends DavCollection {\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(...args) {\n\t\tsuper(...args)\n\n\t\tsuper._registerCollectionFactory('{' + NS.IETF_CARDDAV + '}addressbook', AddressBook)\n\t}\n\n\t/**\n\t * finds all address books in this address book home\n\t *\n\t * @return {Promise<AddressBook[]>}\n\t */\n\tasync findAllAddressBooks() {\n\t\treturn super.findAllByFilter((elm) => elm instanceof AddressBook)\n\t}\n\n\t/**\n\t * creates a new address book collection\n\t *\n\t * @param {string} displayname\n\t * @return {Promise<AddressBook>}\n\t */\n\tasync createAddressBookCollection(displayname) {\n\t\tdebug('creating an addressbook collection')\n\n\t\tconst props = [{\n\t\t\tname: [NS.DAV, 'resourcetype'],\n\t\t\tchildren: [{\n\t\t\t\tname: [NS.DAV, 'collection'],\n\t\t\t}, {\n\t\t\t\tname: [NS.IETF_CARDDAV, 'addressbook'],\n\t\t\t}],\n\t\t}, {\n\t\t\tname: [NS.DAV, 'displayname'],\n\t\t\tvalue: displayname,\n\t\t}]\n\n\t\tconst name = super._getAvailableNameFromToken(displayname)\n\t\treturn super.createCollection(name, props)\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as NS from '../utility/namespaceUtility.js'\n\n/**\n * This function is capable of creating the propset xml structure for:\n * - '{urn:ietf:params:xml:ns:caldav}schedule-default-calendar-URL':\n *\n * @param {object} props\n * @return {object}\n */\nexport default function prinicipalPropSet(props) {\n\tconst xmlified = []\n\n\tObject.entries(props).forEach(([key, value]) => {\n\t\tswitch (key) {\n\t\tcase '{urn:ietf:params:xml:ns:caldav}schedule-default-calendar-URL':\n\t\t\txmlified.push({\n\t\t\t\tname: [NS.IETF_CALDAV, 'schedule-default-calendar-URL'],\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: ['DAV:', 'href'],\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t})\n\t\t\tbreak\n\t\t}\n\t})\n\n\treturn xmlified\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { DavObject } from './davObject.js'\nimport * as NS from '../utility/namespaceUtility.js'\nimport * as XMLUtility from '../utility/xmlUtility.js'\n\nimport prinicipalPropSet from '../propset/principalPropSet.js'\n\n/**\n * @typedef  {object}   PrincipalPropfindOptions\n * @property {boolean=} PrincipalPropfindOptions.enableCalDAV\n * @property {boolean=} PrincipalPropfindOptions.enableCalDAVResourceBooking\n * @property {boolean=} PrincipalPropfindOptions.enableCardDAV\n */\n\n/**\n * @class\n */\nexport class Principal extends DavObject {\n\n\t/**\n\t * Creates an object that represents a single principal\n\t * as specified in RFC 3744\n\t *\n\t * https://tools.ietf.org/html/rfc3744#section-2\n\t *\n\t * @inheritDoc\n\t */\n\tconstructor(...args) {\n\t\tsuper(...args)\n\n\t\tObject.assign(this, {\n\t\t\t// house keeping\n\t\t\t_updatedProperties: [],\n\n\t\t\t// parsers / factories\n\t\t\t_propSetFactory: [],\n\t\t})\n\n\t\tthis._registerPropSetFactory(prinicipalPropSet)\n\n\t\tthis._exposeProperty('displayname', NS.DAV, 'displayname')\n\t\tthis._exposeProperty('calendarUserType', NS.IETF_CALDAV, 'calendar-user-type')\n\t\tthis._exposeProperty('calendarUserAddressSet', NS.IETF_CALDAV, 'calendar-user-address-set')\n\t\tthis._exposeProperty('principalUrl', NS.DAV, 'principal-URL')\n\t\tthis._exposeProperty('email', NS.SABREDAV, 'email-address')\n\t\tthis._exposeProperty('language', NS.NEXTCLOUD, 'language')\n\n\t\tthis._exposeProperty('calendarHomes', NS.IETF_CALDAV, 'calendar-home-set')\n\t\tthis._exposeProperty('scheduleInbox', NS.IETF_CALDAV, 'schedule-inbox-URL')\n\t\tthis._exposeProperty('scheduleOutbox', NS.IETF_CALDAV, 'schedule-outbox-URL')\n\t\tthis._exposeProperty('scheduleDefaultCalendarUrl', NS.IETF_CALDAV, 'schedule-default-calendar-URL', true)\n\n\t\tthis._exposeProperty('addressBookHomes', NS.IETF_CARDDAV, 'addressbook-home-set')\n\n\t\t// Room and resource booking related\n\t\tthis._exposeProperty('roomType', NS.NEXTCLOUD, 'room-type')\n\t\tthis._exposeProperty('roomSeatingCapacity', NS.NEXTCLOUD, 'room-seating-capacity')\n\t\tthis._exposeProperty('roomBuildingAddress', NS.NEXTCLOUD, 'room-building-address')\n\t\tthis._exposeProperty('roomBuildingStory', NS.NEXTCLOUD, 'room-building-story')\n\t\tthis._exposeProperty('roomBuildingRoomNumber', NS.NEXTCLOUD, 'room-building-room-number')\n\t\tthis._exposeProperty('roomFeatures', NS.NEXTCLOUD, 'room-features')\n\n\t\tObject.defineProperties(this, {\n\t\t\tprincipalScheme: {\n\t\t\t\tget: () => {\n\t\t\t\t\tconst baseUrl = this._request.pathname(this._request.baseUrl)\n\t\t\t\t\tlet principalURI = this.url.slice(baseUrl.length)\n\t\t\t\t\tif (principalURI.slice(-1) === '/') {\n\t\t\t\t\t\tprincipalURI = principalURI.slice(0, -1)\n\t\t\t\t\t}\n\n\t\t\t\t\treturn 'principal:' + principalURI\n\t\t\t\t},\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\tget: () => {\n\t\t\t\t\tif (this.calendarUserType !== 'INDIVIDUAL') {\n\t\t\t\t\t\treturn null\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.url.split('/').splice(-2, 2)[this.url.endsWith('/') ? 0 : 1]\n\t\t\t\t},\n\t\t\t},\n\t\t\tgroupId: {\n\t\t\t\tget: () => {\n\t\t\t\t\tif (this.calendarUserType !== 'GROUP') {\n\t\t\t\t\t\treturn null\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.url.split('/').splice(-2, 2)[this.url.endsWith('/') ? 0 : 1]\n\t\t\t\t},\n\t\t\t},\n\t\t\tresourceId: {\n\t\t\t\tget: () => {\n\t\t\t\t\tif (this.calendarUserType !== 'RESOURCE') {\n\t\t\t\t\t\treturn null\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.url.split('/').splice(-2, 2)[this.url.endsWith('/') ? 0 : 1]\n\t\t\t\t},\n\t\t\t},\n\t\t\troomId: {\n\t\t\t\tget: () => {\n\t\t\t\t\tif (this.calendarUserType !== 'ROOM') {\n\t\t\t\t\t\treturn null\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.url.split('/').splice(-2, 2)[this.url.endsWith('/') ? 0 : 1]\n\t\t\t\t},\n\t\t\t},\n\t\t\troomAddress: {\n\t\t\t\tget: () => {\n\t\t\t\t\tconst data = [\n\t\t\t\t\t\tthis.roomBuildingRoomNumber,\n\t\t\t\t\t\tthis.roomBuildingStory,\n\t\t\t\t\t\tthis.roomBuildingAddress,\n\t\t\t\t\t]\n\t\t\t\t\treturn data\n\t\t\t\t\t\t.filter(value => !!value)\n\t\t\t\t\t\t.join(', ')\n\t\t\t\t},\n\t\t\t},\n\t\t})\n\t}\n\n\t/**\n\t * Expose property to the outside and track changes if it's mutable\n\t *\n\t * @protected\n\t * @param {string} localName\n\t * @param {string} xmlNamespace\n\t * @param {string} xmlName\n\t * @param {boolean} mutable\n\t * @return void\n\t */\n\t_exposeProperty(localName, xmlNamespace, xmlName, mutable = false) {\n\t\tif (mutable) {\n\t\t\tObject.defineProperty(this, localName, {\n\t\t\t\tget: () => this._props[`{${xmlNamespace}}${xmlName}`],\n\t\t\t\tset: (val) => {\n\t\t\t\t\tthis._props[`{${xmlNamespace}}${xmlName}`] = val\n\t\t\t\t\tif (this._updatedProperties.indexOf(`{${xmlNamespace}}${xmlName}`) === -1) {\n\t\t\t\t\t\tthis._updatedProperties.push(`{${xmlNamespace}}${xmlName}`)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t})\n\t\t} else {\n\t\t\tObject.defineProperty(this, localName, {\n\t\t\t\tget: () => this._props[`{${xmlNamespace}}${xmlName}`],\n\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * @protected\n\t * @param factory\n\t * @return void\n\t */\n\t_registerPropSetFactory(factory) {\n\t\tthis._propSetFactory.push(factory)\n\t}\n\n\t/**\n\t * @inheritDoc\n\t *\n\t * @param {PrincipalPropfindOptions} options\n\t */\n\tstatic getPropFindList(options = {}) {\n\t\tconst list = [\n\t\t\t[NS.DAV, 'displayname'],\n\t\t\t[NS.IETF_CALDAV, 'calendar-user-type'],\n\t\t\t[NS.IETF_CALDAV, 'calendar-user-address-set'],\n\t\t\t[NS.DAV, 'principal-URL'],\n\t\t\t[NS.DAV, 'alternate-URI-set'],\n\t\t\t[NS.SABREDAV, 'email-address'],\n\t\t\t[NS.NEXTCLOUD, 'language'],\n\t\t]\n\n\t\tif (options.enableCalDAV) {\n\t\t\tlist.push(\n\t\t\t\t[NS.IETF_CALDAV, 'calendar-home-set'],\n\t\t\t\t[NS.IETF_CALDAV, 'schedule-inbox-URL'],\n\t\t\t\t[NS.IETF_CALDAV, 'schedule-outbox-URL'],\n\t\t\t\t[NS.IETF_CALDAV, 'schedule-default-calendar-URL'],\n\t\t\t)\n\t\t}\n\t\tif (options.enableCalDAVResourceBooking || options.enableCalDAV) {\n\t\t\tlist.push(\n\t\t\t\t// Room and Resource booking related\n\t\t\t\t[NS.NEXTCLOUD, 'resource-type'],\n\t\t\t\t[NS.NEXTCLOUD, 'resource-vehicle-type'],\n\t\t\t\t[NS.NEXTCLOUD, 'resource-vehicle-make'],\n\t\t\t\t[NS.NEXTCLOUD, 'resource-vehicle-model'],\n\t\t\t\t[NS.NEXTCLOUD, 'resource-vehicle-is-electric'],\n\t\t\t\t[NS.NEXTCLOUD, 'resource-vehicle-range'],\n\t\t\t\t[NS.NEXTCLOUD, 'resource-vehicle-seating-capacity'],\n\t\t\t\t[NS.NEXTCLOUD, 'resource-contact-person'],\n\t\t\t\t[NS.NEXTCLOUD, 'resource-contact-person-vcard'],\n\t\t\t\t[NS.NEXTCLOUD, 'room-type'],\n\t\t\t\t[NS.NEXTCLOUD, 'room-seating-capacity'],\n\t\t\t\t[NS.NEXTCLOUD, 'room-building-address'],\n\t\t\t\t[NS.NEXTCLOUD, 'room-building-story'],\n\t\t\t\t[NS.NEXTCLOUD, 'room-building-room-number'],\n\t\t\t\t[NS.NEXTCLOUD, 'room-features'],\n\t\t\t)\n\t\t}\n\t\tif (options.enableCardDAV) {\n\t\t\tlist.push(\n\t\t\t\t[NS.IETF_CARDDAV, 'addressbook-home-set'],\n\t\t\t)\n\t\t}\n\n\t\treturn list\n\t}\n\n\t/**\n\t * Sends a PropPatch request to update the principal's properties.\n\t * The request is only made if properties actually changed.\n\t *\n\t * @return {Promise<void>}\n\t */\n\tasync update() {\n\t\tif (this._updatedProperties.length === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tconst properties = {}\n\t\tthis._updatedProperties.forEach((updatedProperty) => {\n\t\t\tproperties[updatedProperty] = this._props[updatedProperty]\n\t\t})\n\t\tconst propSet = this._propSetFactory.reduce((arr, p) => [...arr, ...p(properties)], [])\n\n\t\tconst [skeleton, dPropSet] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.DAV, 'propertyupdate'],\n\t\t\t[NS.DAV, 'set'],\n\t\t\t[NS.DAV, 'prop'])\n\n\t\tdPropSet.push(...propSet)\n\n\t\tconst body = XMLUtility.serialize(skeleton)\n\t\tawait this._request.propPatch(this._url, {}, body)\n\t}\n\n}\n","/**\n * CDAV Library\n *\n * This library is part of the Nextcloud project\n *\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport Parser from './parser.js'\nimport Request from './request.js'\nimport * as NS from './utility/namespaceUtility.js'\nimport * as XMLUtility from './utility/xmlUtility.js'\nimport { CalendarHome } from './models/calendarHome.js'\nimport { AddressBookHome } from './models/addressBookHome.js'\nimport { Principal } from './models/principal.js'\n\nimport { debugFactory } from './debug.js'\nconst debug = debugFactory('index.js')\n\nexport { debugFactory as debug, NS as namespaces }\n\n/**\n *\n */\nexport default class DavClient {\n\n\t/**\n\t * @param {object} options\n\t * @param {string} options.rootUrl\n\t * @param {Function} xhrProvider\n\t * @param {object} factories\n\t */\n\tconstructor(options, xhrProvider = null, factories = {}) {\n\t\t/**\n\t\t * root URL of DAV Server\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tthis.rootUrl = null\n\n\t\tif (options.rootUrl.slice(-1) !== '/') {\n\t\t\toptions.rootUrl += '/'\n\t\t}\n\n\t\t// overwrite rootUrl if passed as argument\n\t\tObject.assign(this, options)\n\n\t\t/**\n\t\t * List of advertised DAV features\n\t\t *\n\t\t * @type {string[]}\n\t\t */\n\t\tthis.advertisedFeatures = []\n\n\t\t/**\n\t\t * Principal object of current user\n\t\t *\n\t\t * @type {Principal}\n\t\t */\n\t\tthis.currentUserPrincipal = null\n\n\t\t/**\n\t\t * Array of links to principal collections\n\t\t *\n\t\t * @type {string[]}\n\t\t */\n\t\tthis.principalCollections = []\n\n\t\t/**\n\t\t * Array of calendar homes\n\t\t * will be filled after connect() was called\n\t\t *\n\t\t * @type {CalendarHome[]}\n\t\t */\n\t\tthis.calendarHomes = []\n\n\t\t/**\n\t\t * The calendar-home that houses all public calendars\n\t\t * findAll will obviously not work ;)\n\t\t * use find(token) to get a public calendar\n\t\t *\n\t\t * @type {CalendarHome|null}\n\t\t */\n\t\tthis.publicCalendarHome = null\n\n\t\t/**\n\t\t * Array of address book homes\n\t\t * will be filled after connect() was called\n\t\t *\n\t\t * @type {AddressBookHome[]}\n\t\t */\n\t\tthis.addressBookHomes = []\n\n\t\t/**\n\t\t *\n\t\t * @type {Parser}\n\t\t */\n\t\tthis.parser = new Parser()\n\n\t\t/**\n\t\t *\n\t\t * @type {boolean}\n\t\t * @private\n\t\t */\n\t\tthis._isConnected = false\n\n\t\t/**\n\t\t *\n\t\t * @type {Request}\n\t\t * @private\n\t\t */\n\t\tthis._request = new Request(this.rootUrl, this.parser, xhrProvider)\n\t}\n\n\t/**\n\t * initializes the DAVClient\n\t * @param {object} options\n\t * @return {Promise<DavClient>}\n\t */\n\tasync connect(options = { enableCalDAV: false, enableCardDAV: false }) {\n\t\tif (this._isConnected) {\n\t\t\treturn this\n\t\t}\n\n\t\t// we don't support rfc 6764 for now - Pull-requests welcome :)\n\t\tif (!this.rootUrl) {\n\t\t\tthrow new Error('No rootUrl configured')\n\t\t}\n\n\t\tconst principalUrl = await this._discoverPrincipalUri()\n\t\tdebug(`PrincipalURL: ${principalUrl}`)\n\n\t\tconst propFindList = Principal.getPropFindList(options)\n\t\tif (options.enableCalDAV || options.enableCardDAV) {\n\t\t\tpropFindList.push(\n\t\t\t\t[NS.DAV, 'principal-collection-set'],\n\t\t\t\t[NS.DAV, 'supported-report-set'],\n\t\t\t)\n\t\t}\n\n\t\tconst response = await this._request.propFind(principalUrl, propFindList)\n\n\t\tthis.currentUserPrincipal = new Principal(null, this._request, principalUrl, response.body)\n\t\tthis._extractAdvertisedDavFeatures(response.xhr)\n\t\tthis._extractAddressBookHomes(response.body)\n\t\tthis._extractCalendarHomes(response.body)\n\t\tthis._extractPrincipalCollectionSets(response.body)\n\t\tthis._createPublicCalendarHome()\n\n\t\tthis._isConnected = true\n\n\t\treturn this\n\t}\n\n\t// /**\n\t//  * @returns {Promise<[any , any , any , any , any , any , any , any , any , any]>}\n\t//  */\n\t// async sync() {\n\t//     const promises = [];\n\t//\n\t//     // Ideally we would also check for new calendar-homes and\n\t//     // new addressbook-homes as well, but then Nextcloud will\n\t//     // ever only send provide one each, so we omit this step\n\t//     // to cut down network traffic\n\t//\n\t//     this.calendarHomes.forEach((calendarHome) => {\n\t//         promises.push(calendarHome.sync());\n\t//     });\n\t//     this.addressbookHomes.forEach((addressbookHome) => {\n\t//         promises.push(addressbookHome.sync());\n\t//     });\n\t//\n\t//     return Promise.all(promises);\n\t// }\n\n\t/**\n\t * performs a principal property search based on a principal's displayname\n\t *\n\t * @param {string} name\n\t * @return {Promise<Principal[]>}\n\t */\n\tasync principalPropertySearchByDisplayname(name) {\n\t\treturn this.principalPropertySearch([\n\t\t\t{ name: [NS.DAV, 'displayname'] },\n\t\t], name)\n\t}\n\n\t/**\n\t * performs a principal property search based on a principal's displayname OR email address\n\t *\n\t * @param {string} value\n\t * @return {Promise<Principal[]>}\n\t */\n\tasync principalPropertySearchByDisplaynameOrEmail(value) {\n\t\treturn this.principalPropertySearch([\n\t\t\t{ name: [NS.DAV, 'displayname'] },\n\t\t\t{ name: [NS.SABREDAV, 'email-address'] },\n\t\t], value, 'anyof')\n\t}\n\n\t/**\n\t * Performs a principal property based on the address of a room\n\t *\n\t * @param {string} address Address of the building the room is in\n\t * @return {Promise<Principal[]>}\n\t */\n\tasync principalPropertySearchByAddress(address) {\n\t\treturn this.principalPropertySearch([\n\t\t\t{ name: [NS.NEXTCLOUD, 'room-building-address'] },\n\t\t], address)\n\t}\n\n\t/**\n\t * Performs a principal property search based on the address and story of a room\n\t *\n\t * @param {string} address Address of the building the room is in\n\t * @param {string} story Story inside the building the room is in\n\t * @return {Promise<[]>}\n\t */\n\tasync principalPropertySearchByAddressAndStory(address, story) {\n\t\tconst [skeleton] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.DAV, 'principal-property-search'])\n\n\t\tskeleton.children.push({\n\t\t\tname: [NS.DAV, 'property-search'],\n\t\t\tchildren: [{\n\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.NEXTCLOUD, 'room-building-address'],\n\t\t\t\t}],\n\t\t\t}, {\n\t\t\t\tname: [NS.DAV, 'match'],\n\t\t\t\tvalue: address,\n\t\t\t}],\n\t\t})\n\t\tskeleton.children.push({\n\t\t\tname: [NS.DAV, 'property-search'],\n\t\t\tchildren: [{\n\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.NEXTCLOUD, 'room-building-story'],\n\t\t\t\t}],\n\t\t\t}, {\n\t\t\t\tname: [NS.DAV, 'match'],\n\t\t\t\tvalue: story,\n\t\t\t}],\n\t\t})\n\n\t\tskeleton.children.push({\n\t\t\tname: [NS.DAV, 'prop'],\n\t\t\tchildren: Principal\n\t\t\t\t.getPropFindList({ enableCalDAV: true })\n\t\t\t\t.map((propFindListItem) => ({ name: propFindListItem })),\n\t\t})\n\n\t\t// We are searching all principal collections, not just one\n\t\tskeleton.children.push({ name: [NS.DAV, 'apply-to-principal-collection-set'] })\n\n\t\tconst xml = XMLUtility.serialize(skeleton)\n\t\treturn this._request.report(this.rootUrl, { Depth: 0 }, xml).then((response) => {\n\t\t\tconst result = []\n\n\t\t\tObject.entries(response.body).forEach(([path, props]) => {\n\t\t\t\tconst url = this._request.pathname(path)\n\t\t\t\tresult.push(new Principal(null, this._request, url, props))\n\t\t\t})\n\n\t\t\treturn result\n\t\t})\n\t}\n\n\t/**\n\t * Performs a principal property search based on multiple advanced filters\n\t *\n\t * @param {object} query The destructuring query object\n\t * @param {string=} query.displayName The display name to filter by\n\t * @param {number=} query.capacity The minimum required seating capacity\n\t * @param {string[]=} query.features The features to filter by\n\t * @param {string=} query.roomType The room type to filter by\n\t * @return {Promise<Principal[]>}\n\t */\n\tasync advancedPrincipalPropertySearch(query) {\n\t\tconst [skeleton] = XMLUtility.getRootSkeleton([NS.DAV, 'principal-property-search'])\n\n\t\t// Every prop has to match\n\t\tskeleton.attributes = [\n\t\t\t['test', 'allof'],\n\t\t]\n\n\t\tconst { displayName, capacity, features, roomType } = query\n\t\tif (displayName) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'property-search'],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{ name: [NS.DAV, 'displayname'] },\n\t\t\t\t\t],\n\t\t\t\t}, {\n\t\t\t\t\tname: [NS.DAV, 'match'],\n\t\t\t\t\tvalue: displayName,\n\t\t\t\t}],\n\t\t\t})\n\t\t}\n\t\tif (capacity) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'property-search'],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\t\tchildren: [{\n\t\t\t\t\t\tname: [NS.NEXTCLOUD, 'room-seating-capacity'],\n\t\t\t\t\t}],\n\t\t\t\t}, {\n\t\t\t\t\tname: [NS.DAV, 'match'],\n\t\t\t\t\tvalue: capacity,\n\t\t\t\t}],\n\t\t\t})\n\t\t}\n\t\tif (features && features.length > 0) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'property-search'],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\t\tchildren: [{\n\t\t\t\t\t\tname: [NS.NEXTCLOUD, 'room-features'],\n\t\t\t\t\t}],\n\t\t\t\t}, {\n\t\t\t\t\tname: [NS.DAV, 'match'],\n\t\t\t\t\tvalue: features.join(','),\n\t\t\t\t}],\n\t\t\t})\n\t\t}\n\t\tif (roomType) {\n\t\t\tskeleton.children.push({\n\t\t\t\tname: [NS.DAV, 'property-search'],\n\t\t\t\tchildren: [{\n\t\t\t\t\tname: [NS.DAV, 'prop'],\n\t\t\t\t\tchildren: [{\n\t\t\t\t\t\tname: [NS.NEXTCLOUD, 'room-type'],\n\t\t\t\t\t}],\n\t\t\t\t}, {\n\t\t\t\t\tname: [NS.DAV, 'match'],\n\t\t\t\t\tvalue: roomType,\n\t\t\t\t}],\n\t\t\t})\n\t\t}\n\n\t\t// Do not perform search if no parameter is given\n\t\tif (skeleton.children.length === 0) {\n\t\t\treturn []\n\t\t}\n\n\t\tskeleton.children.push({\n\t\t\tname: [NS.DAV, 'prop'],\n\t\t\tchildren: Principal\n\t\t\t\t.getPropFindList({ enableCalDAV: true })\n\t\t\t\t.map((propFindListItem) => ({ name: propFindListItem })),\n\t\t})\n\n\t\t// We are searching all principal collections, not just one\n\t\tskeleton.children.push({ name: [NS.DAV, 'apply-to-principal-collection-set'] })\n\n\t\tconst xml = XMLUtility.serialize(skeleton)\n\t\tconst response = await this._request.report(this.rootUrl, { Depth: 0 }, xml)\n\t\treturn Object\n\t\t\t.entries(response.body)\n\t\t\t.map(([path, props]) => {\n\t\t\t\tconst url = this._request.pathname(path)\n\t\t\t\treturn new Principal(null, this._request, url, props)\n\t\t\t})\n\t}\n\n\t/**\n\t * performs a principal property search\n\t * @see https://tools.ietf.org/html/rfc3744#section-9.4\n\t *\n\t * @param {Array} props\n\t * @param {string} match\n\t * @param {string} test 'anyof', 'allof' or none\n\t * @return {Promise<Principal[]>}\n\t */\n\tasync principalPropertySearch(props, match, test) {\n\t\tconst [skeleton, propSearch] = XMLUtility.getRootSkeleton(\n\t\t\t[NS.DAV, 'principal-property-search'],\n\t\t\t[NS.DAV, 'property-search'],\n\t\t)\n\t\tif (test) {\n\t\t\tskeleton.attributes = [\n\t\t\t\t['test', test],\n\t\t\t]\n\t\t}\n\n\t\tpropSearch.push({\n\t\t\tname: [NS.DAV, 'prop'],\n\t\t\tchildren: props,\n\t\t}, {\n\t\t\tname: [NS.DAV, 'match'],\n\t\t\tvalue: match,\n\t\t})\n\n\t\tskeleton.children.push({\n\t\t\tname: [NS.DAV, 'prop'],\n\t\t\tchildren: Principal\n\t\t\t\t.getPropFindList({ enableCalDAV: true })\n\t\t\t\t.map((propFindListItem) => ({ name: propFindListItem })),\n\t\t})\n\n\t\t// We are searching all principal collections, not just one\n\t\tskeleton.children.push({ name: [NS.DAV, 'apply-to-principal-collection-set'] })\n\n\t\tconst xml = XMLUtility.serialize(skeleton)\n\t\treturn this._request.report(this.rootUrl, { Depth: 0 }, xml).then((response) => {\n\t\t\tconst result = []\n\n\t\t\tObject.entries(response.body).forEach(([path, props]) => {\n\t\t\t\tconst url = this._request.pathname(path)\n\t\t\t\tresult.push(new Principal(null, this._request, url, props))\n\t\t\t})\n\n\t\t\treturn result\n\t\t})\n\t}\n\n\t/**\n\t * finds one principal at a given principalUrl\n\t *\n\t * @param {string} principalUrl\n\t * @return {Promise<Principal>}\n\t */\n\tasync findPrincipal(principalUrl) {\n\t\treturn this._request.propFind(principalUrl, Principal.getPropFindList()).then(({ body }) => {\n\t\t\treturn new Principal(null, this._request, principalUrl, body)\n\t\t}).catch((err) => {\n\t\t\t// TODO: improve error handling\n\t\t\tconsole.debug(err)\n\t\t})\n\t}\n\n\t/**\n\t * finds all principals in a collection at a given principalCollectionUrl\n\t *\n\t * @param {string} principalCollectionUrl\n\t * @param {import('./models/principal.js').PrincipalPropfindOptions} options Passed to Principal.getPropFindList()\n\t * @return {Promise<Principal[]>}\n\t */\n\tasync findPrincipalsInCollection(principalCollectionUrl, options = {}) {\n\t\ttry {\n\t\t\tconst { body } = await this._request.propFind(\n\t\t\t\tprincipalCollectionUrl,\n\t\t\t\tPrincipal.getPropFindList(options),\n\t\t\t\t1,\n\t\t\t)\n\t\t\tconst principals = Object.entries(body)\n\t\t\t\t.filter(([principalUrl]) => !principalCollectionUrl.endsWith(principalUrl))\n\t\t\t\t.map(([principalUrl, principal]) => new Principal(\n\t\t\t\t\tnull,\n\t\t\t\t\tthis._request,\n\t\t\t\t\tprincipalUrl,\n\t\t\t\t\tprincipal,\n\t\t\t\t))\n\t\t\treturn principals\n\t\t} catch (err) {\n\t\t\t// TODO: improve error handling\n\t\t\tconsole.debug(err)\n\t\t}\n\t}\n\n\t/**\n\t * discovers the accounts principal uri solely based on rootURL\n\t *\n\t * @return {Promise<string>}\n\t * @private\n\t */\n\tasync _discoverPrincipalUri() {\n\t\tconst response = await this._request.propFind(this.rootUrl, [\n\t\t\t[NS.DAV, 'current-user-principal'],\n\t\t], 0)\n\n\t\tif (!response.body['{DAV:}current-user-principal']) {\n\t\t\tthrow new Error('Error retrieving current user principal')\n\t\t}\n\t\tif (response.body['{DAV:}current-user-principal'].type === 'unauthenticated') {\n\t\t\tthrow new Error('Current user is not authenticated')\n\t\t}\n\t\treturn this._request.pathname(response.body['{DAV:}current-user-principal'].href)\n\t}\n\n\t/**\n\t * discovers all calendar-homes in this account, all principal collections\n\t * and advertised features\n\t *\n\t * a user will most commonly only have one calendar-home,\n\t * the CalDAV standard allows multiple calendar-homes though\n\t *\n\t * @param {object} props\n\t * @return void\n\t * @private\n\t */\n\tasync _extractCalendarHomes(props) {\n\t\tconst calendarHomes = props[`{${NS.IETF_CALDAV}}calendar-home-set`]\n\t\tif (!calendarHomes) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.calendarHomes = calendarHomes.map((calendarHome) => {\n\t\t\tconst url = this._request.pathname(calendarHome)\n\t\t\treturn new CalendarHome(this, this._request, url, props)\n\t\t})\n\t}\n\n\t/**\n\t * discovers all address-book-homes in this account, all principal collections\n\t * and advertised features\n\t *\n\t * a user will most commonly only have one address-book-home,\n\t * the CardDAV standard allows multiple address-book-homes though\n\t *\n\t * @param {object} props\n\t * @return void\n\t * @private\n\t */\n\tasync _extractAddressBookHomes(props) {\n\t\tconst addressBookHomes = props[`{${NS.IETF_CARDDAV}}addressbook-home-set`]\n\t\tif (!addressBookHomes) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.addressBookHomes = addressBookHomes.map((addressbookHome) => {\n\t\t\tconst url = this._request.pathname(addressbookHome)\n\t\t\treturn new AddressBookHome(this, this._request, url, props)\n\t\t})\n\t}\n\n\t/**\n\t * extracts principalCollection Information from an existing props object\n\t * returned from the server\n\t *\n\t * @param {object} props\n\t * @return void\n\t * @private\n\t */\n\t_extractPrincipalCollectionSets(props) {\n\t\tconst principalCollectionSets = props[`{${NS.DAV}}principal-collection-set`]\n\t\tthis.principalCollections = principalCollectionSets.map((principalCollection) => {\n\t\t\treturn this._request.pathname(principalCollection)\n\t\t})\n\t}\n\n\t/**\n\t * extracts the advertised features supported by the DAV server\n\t *\n\t * @param {XMLHttpRequest} xhr\n\t * @return void\n\t * @private\n\t */\n\t_extractAdvertisedDavFeatures(xhr) {\n\t\tconst dav = xhr.getResponseHeader('DAV')\n\t\tthis.advertisedFeatures.push(...dav.split(',').map((s) => s.trim()))\n\t}\n\n\t/**\n\t * Creates a public calendar home\n\t *\n\t * @return void\n\t * @private\n\t */\n\t_createPublicCalendarHome() {\n\t\tconst url = this._request.pathname(this.rootUrl) + 'public-calendars/'\n\t\tthis.publicCalendarHome = new CalendarHome(this, this._request, url, {})\n\t}\n\n}\n"],"names":["document","localName","XMLUtility.getRootSkeleton","NS.DAV","XMLUtility.serialize","resolve","NS.resolve","uri","debug","StringUtility.uri","NS.CALENDARSERVER","NS.OWNCLOUD","NS.IETF_CALDAV","calendarPropSet","NS.APPLE","StringUtility.uid","NS.NEXTCLOUD","scheduleInboxPropSet","NS.IETF_CARDDAV","NS.SABREDAV","props"],"mappings":"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"}